<!DOCTYPE html>
<html lang="en"><head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1"><!-- Begin Jekyll SEO tag v2.6.1 -->
<title>Implementing Proxy Pattern in Python | Red’s Digressions</title>
<meta name="generator" content="Jekyll v4.0.0" />
<meta property="og:title" content="Implementing Proxy Pattern in Python" />
<meta property="og:locale" content="en_US" />
<meta name="description" content="Dipping toes into the realm of structural design patterns" />
<meta property="og:description" content="Dipping toes into the realm of structural design patterns" />
<link rel="canonical" href="https://rednafi.github.io/digressions/python/2020/06/16/python-proxy-pattern.html" />
<meta property="og:url" content="https://rednafi.github.io/digressions/python/2020/06/16/python-proxy-pattern.html" />
<meta property="og:site_name" content="Red’s Digressions" />
<meta property="og:type" content="article" />
<meta property="article:published_time" content="2020-06-16T00:00:00-05:00" />
<script type="application/ld+json">
{"datePublished":"2020-06-16T00:00:00-05:00","headline":"Implementing Proxy Pattern in Python","description":"Dipping toes into the realm of structural design patterns","mainEntityOfPage":{"@type":"WebPage","@id":"https://rednafi.github.io/digressions/python/2020/06/16/python-proxy-pattern.html"},"@type":"BlogPosting","url":"https://rednafi.github.io/digressions/python/2020/06/16/python-proxy-pattern.html","dateModified":"2020-06-16T00:00:00-05:00","@context":"https://schema.org"}</script>
<!-- End Jekyll SEO tag -->
<link rel="stylesheet" href="/digressions/assets/css/style.css"><link type="application/atom+xml" rel="alternate" href="https://rednafi.github.io/digressions/feed.xml" title="Red's Digressions" /><!-- the google_analytics_id gets auto inserted from the config file -->



<script>(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)})(window,document,'script','//www.google-analytics.com/analytics.js','ga');ga('create','UA-160409032-1','auto');ga('require','displayfeatures');ga('send','pageview');</script>

<link rel="shortcut icon" type="image/x-icon" href="/digressions/images/favicon.ico"><!-- Begin Jekyll SEO tag v2.6.1 -->
<title>Implementing Proxy Pattern in Python | Red’s Digressions</title>
<meta name="generator" content="Jekyll v4.0.0" />
<meta property="og:title" content="Implementing Proxy Pattern in Python" />
<meta property="og:locale" content="en_US" />
<meta name="description" content="Dipping toes into the realm of structural design patterns" />
<meta property="og:description" content="Dipping toes into the realm of structural design patterns" />
<link rel="canonical" href="https://rednafi.github.io/digressions/python/2020/06/16/python-proxy-pattern.html" />
<meta property="og:url" content="https://rednafi.github.io/digressions/python/2020/06/16/python-proxy-pattern.html" />
<meta property="og:site_name" content="Red’s Digressions" />
<meta property="og:type" content="article" />
<meta property="article:published_time" content="2020-06-16T00:00:00-05:00" />
<script type="application/ld+json">
{"datePublished":"2020-06-16T00:00:00-05:00","headline":"Implementing Proxy Pattern in Python","description":"Dipping toes into the realm of structural design patterns","mainEntityOfPage":{"@type":"WebPage","@id":"https://rednafi.github.io/digressions/python/2020/06/16/python-proxy-pattern.html"},"@type":"BlogPosting","url":"https://rednafi.github.io/digressions/python/2020/06/16/python-proxy-pattern.html","dateModified":"2020-06-16T00:00:00-05:00","@context":"https://schema.org"}</script>
<!-- End Jekyll SEO tag -->

<link href="https://unpkg.com/@primer/css/dist/primer.css" rel="stylesheet" />
<link rel="stylesheet" href="//use.fontawesome.com/releases/v5.0.7/css/all.css"><link type="application/atom+xml" rel="alternate" href="https://rednafi.github.io/digressions/feed.xml" title="Red's Digressions" /><!-- the google_analytics_id gets auto inserted from the config file -->



<script>(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)})(window,document,'script','//www.google-analytics.com/analytics.js','ga');ga('create','UA-160409032-1','auto');ga('require','displayfeatures');ga('send','pageview');</script>


    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.11.1/dist/katex.min.css" integrity="sha384-zB1R0rpPzHqg7Kpt0Aljp8JPLqbXI3bhnPWROx27a9N0Ll6ZP/+DiW/UqRcLbRjq" crossorigin="anonymous">
    <script type="text/javascript" async src="https://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-MML-AM_CHTML"> </script>
    <script defer src="https://cdn.jsdelivr.net/npm/katex@0.11.1/dist/katex.min.js" integrity="sha384-y23I5Q6l+B6vatafAwxRu/0oK/79VlbSz7Q9aiSZUvyWYIYsd+qj+o24G5ZU2zJz" crossorigin="anonymous"></script>
    <script defer src="https://cdn.jsdelivr.net/npm/katex@0.11.1/dist/contrib/auto-render.min.js" integrity="sha384-kWPLUVMOks5AQFrykwIup5lo0m3iMkkHrD0uJ4H5cjeGihAutqP0yW0J6dpFiVkI" crossorigin="anonymous"></script>
    <script>
    document.addEventListener("DOMContentLoaded", function() {
        renderMathInElement( document.body, {
        delimiters: [
            {left: "$$", right: "$$", display: true},
            {left: "[%", right: "%]", display: true},
            {left: "$", right: "$", display: false}
        ]}
        );
    });
    </script>


<script>
function wrap_img(fn) {
    if (document.attachEvent ? document.readyState === "complete" : document.readyState !== "loading") {
        var elements = document.querySelectorAll(".post img");
        Array.prototype.forEach.call(elements, function(el, i) {
            if (el.getAttribute("title")) {
                const caption = document.createElement('figcaption');
                var node = document.createTextNode(el.getAttribute("title"));
                caption.appendChild(node);
                const wrapper = document.createElement('figure');
                wrapper.className = 'image';
                el.parentNode.insertBefore(wrapper, el);
                el.parentNode.removeChild(el);
                wrapper.appendChild(el);
                wrapper.appendChild(caption);
            }
        });
    } else { document.addEventListener('DOMContentLoaded', fn); }
}
window.onload = wrap_img;
</script>

<script>
    document.addEventListener("DOMContentLoaded", function(){
    // add link icon to anchor tags
    var elem = document.querySelectorAll(".anchor-link")
    elem.forEach(e => (e.innerHTML = '<i class="fas fa-link fa-xs"></i>'));
    });
</script>
</head><body><header class="site-header">

  <div class="wrapper"><a class="site-title" rel="author" href="/digressions/">Red&#39;s Digressions</a><nav class="site-nav">
        <input type="checkbox" id="nav-trigger" class="nav-trigger" />
        <label for="nav-trigger">
          <span class="menu-icon">
            <svg viewBox="0 0 18 15" width="18px" height="15px">
              <path d="M18,1.484c0,0.82-0.665,1.484-1.484,1.484H1.484C0.665,2.969,0,2.304,0,1.484l0,0C0,0.665,0.665,0,1.484,0 h15.032C17.335,0,18,0.665,18,1.484L18,1.484z M18,7.516C18,8.335,17.335,9,16.516,9H1.484C0.665,9,0,8.335,0,7.516l0,0 c0-0.82,0.665-1.484,1.484-1.484h15.032C17.335,6.031,18,6.696,18,7.516L18,7.516z M18,13.516C18,14.335,17.335,15,16.516,15H1.484 C0.665,15,0,14.335,0,13.516l0,0c0-0.82,0.665-1.483,1.484-1.483h15.032C17.335,12.031,18,12.695,18,13.516L18,13.516z"/>
            </svg>
          </span>
        </label>

        <div class="trigger"><a class="page-link" href="/digressions/about/">About Me</a><a class="page-link" href="/digressions/search/">Search</a><a class="page-link" href="/digressions/categories/">Tags</a></div>
      </nav></div>
</header>
<main class="page-content" aria-label="Content">
      <div class="wrapper">
        <article class="post h-entry" itemscope itemtype="http://schema.org/BlogPosting">

  <header class="post-header">
    <h1 class="post-title p-name" itemprop="name headline">Implementing Proxy Pattern in Python
    </h1><p class="page-description">Dipping toes into the realm of structural design patterns</p><p class="post-meta post-meta-title"><time class="dt-published" datetime="2020-06-16T00:00:00-05:00"
        itemprop="datePublished">
        Jun 16, 2020
      </time>
      • <span class="read-time" title="Estimated read time">
    
    
      15 min read
    
</span></p>

    
    <p class="category-tags"><i class="fas fa-tags category-tags-icon"></i></i>
      
      <a class="category-tags-link"
        href="/digressions/categories/#Python">Python</a>
      
      
    </p>
    

    </header>

  <div class="post-content e-content" itemprop="articleBody">
    <ul class="section-nav">
<li class="toc-entry toc-h2"><a href="#the-proxy-pattern">The Proxy Pattern</a></li>
<li class="toc-entry toc-h2"><a href="#why-use-it">Why Use It?</a>
<ul>
<li class="toc-entry toc-h3"><a href="#loose-coupling">Loose Coupling</a></li>
<li class="toc-entry toc-h3"><a href="#enhanced-testability">Enhanced Testability</a></li>
</ul>
</li>
<li class="toc-entry toc-h2"><a href="#proxy-pattern-with-interface">Proxy Pattern with Interface</a></li>
<li class="toc-entry toc-h2"><a href="#another-practical-example">Another Practical Example</a></li>
<li class="toc-entry toc-h2"><a href="#should-you-use-it">Should You Use It?</a></li>
<li class="toc-entry toc-h2"><a href="#remarks">Remarks</a></li>
<li class="toc-entry toc-h2"><a href="#references">References</a></li>
</ul><p>In Python, there’s a saying that <em><a href="https://en.wikipedia.org/wiki/Design_Patterns">design patterns</a> are anti-patterns</em>. Also, in the realm of dynamic languages, design patterns have the notoriety of injecting additional abstraction layers to the core logic and making the flow gratuitously obscure. Python’s dynamic nature and the treatment of functions as <a href="https://dbader.org/blog/python-first-class-functions">first-class</a> objects often make Java-ish design patterns redundant. Instead of littering your code with seemingly over-engineered patterns, you can almost always take the advantage of Python’s first-class objects, duck-typing, monkey-patching etc to accomplish the task at hand. However, recently there is one design pattern that I find myself using over and over again to write more maintainable code and that is the Proxy pattern. So I thought I’d document it here for future reference.</p>

<h2 id="the-proxy-pattern">
<a class="anchor" href="#the-proxy-pattern" aria-hidden="true"><span class="octicon octicon-link"></span></a>The Proxy Pattern</h2>

<p>Before diving into the academic definition, let’s try to understand the Proxy pattern from an example.</p>

<p>Have you ever used an access card to go through a door? There are multiple options to open that door i.e. it can be opened either using access card or by pressing a button that bypasses the security. The door’s main functionality is to open but there is a proxy added on top of it to add some functionality. Let me better explain it using the code example below.</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">class</span> <span class="nc">Door</span><span class="p">:</span>
    <span class="k">def</span> <span class="nf">open_method</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="bp">None</span><span class="p">:</span>
        <span class="k">pass</span>


<span class="k">class</span> <span class="nc">SecuredDoor</span><span class="p">:</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="bp">None</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_klass</span> <span class="o">=</span> <span class="n">Door</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">open_method</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="bp">None</span><span class="p">:</span>
        <span class="k">print</span><span class="p">(</span><span class="n">f</span><span class="s">"Adding security measure to the method of {self._klass}"</span><span class="p">)</span>


<span class="n">secured_door</span> <span class="o">=</span> <span class="n">SecuredDoor</span><span class="p">()</span>
<span class="n">secured_door</span><span class="o">.</span><span class="n">open_method</span><span class="p">()</span>
</code></pre></div></div>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>&gt;&gt;&gt; Adding security measure to the method of &lt;__main__.Door object at 0x7f9dab3b6670&gt;
</code></pre></div></div>

<p>The above code snippet concretizes the example given before. Here, the <code class="highlighter-rouge">Door</code> class has a single method called <code class="highlighter-rouge">open_method</code> which denotes the action of <em>opening</em> on the <code class="highlighter-rouge">Door</code> object. This method gets extended in the <code class="highlighter-rouge">SecuredDoor</code> class and in this case, I’ve just added a print statement to the method of the latter class.</p>

<p>Notice how the class <code class="highlighter-rouge">Door</code> was called from <code class="highlighter-rouge">SecuredDoor</code> via <a href="https://realpython.com/inheritance-composition-python/#composition-in-python">composition</a>. In the case of proxy pattern, you can substitute primary object with the proxy object without any additional changes in the code. This conforms to the <a href="https://en.wikipedia.org/wiki/Liskov_substitution_principle">Liskov Substitution Principle</a>. It states that:</p>

<blockquote>
  <p>Objects of a superclass shall be replaceable with objects of its subclasses without breaking the application. That requires the objects of your subclasses to behave in the same way as the objects of your superclass.</p>
</blockquote>

<p>The <code class="highlighter-rouge">Door</code> object can be replaced by the <code class="highlighter-rouge">SecuredDoor</code> and the <code class="highlighter-rouge">SecuredDoor</code> class does not introduce any new methods, it only extends the functionality of the <code class="highlighter-rouge">open_method</code> of the <code class="highlighter-rouge">Door</code> class.</p>

<p>In plain words,</p>

<blockquote>
  <p>Using the proxy pattern, a class represents the functionality of another class.</p>
</blockquote>

<p>Wikipedia says,</p>

<blockquote>
  <p>A proxy, in its most general form, is a class functioning as an interface to something else. A proxy is a wrapper or agent object that is being called by the client to access the real serving object behind the scenes. Use of the proxy can simply be forwarding to the real object, or can provide additional logic. In the proxy extra functionality can be provided, for example caching when operations on the real object are resource intensive, or checking preconditions before operations on the real object are invoked.</p>
</blockquote>

<p>Pedagogically, the proxy pattern belongs to a family of patterns called the <a href="https://en.wikipedia.org/wiki/Structural_pattern">structural pattern</a>.</p>

<h2 id="why-use-it">
<a class="anchor" href="#why-use-it" aria-hidden="true"><span class="octicon octicon-link"></span></a>Why Use It?</h2>

<h3 id="loose-coupling">
<a class="anchor" href="#loose-coupling" aria-hidden="true"><span class="octicon octicon-link"></span></a>Loose Coupling</h3>

<p>Proxy pattern let’s you easily decouple your core logic from the added functionalities that might be needed on top of that. The modular nature of the code makes maintaining and extending the functionalities of your primary logic a lot quicker and easier.</p>

<p>Suppose, you’re defining a <code class="highlighter-rouge">division</code> function that takes takes two integer as arguments and returns the result of the division between them. It also handles edge cases like <code class="highlighter-rouge">ZeroDivisionError</code> or <code class="highlighter-rouge">TypeError</code> and logs them properly.</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">import</span> <span class="nn">logging</span>
<span class="kn">from</span> <span class="nn">typing</span> <span class="kn">import</span> <span class="n">Union</span>

<span class="n">logging</span><span class="o">.</span><span class="n">basicConfig</span><span class="p">(</span><span class="n">level</span><span class="o">=</span><span class="n">logging</span><span class="o">.</span><span class="n">INFO</span><span class="p">)</span>


<span class="k">def</span> <span class="nf">division</span><span class="p">(</span><span class="n">a</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="nb">float</span><span class="p">],</span> <span class="n">b</span><span class="p">:</span> <span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="nb">float</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="nb">float</span><span class="p">:</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">result</span> <span class="o">=</span> <span class="n">a</span> <span class="o">/</span> <span class="n">b</span>
        <span class="k">return</span> <span class="n">result</span>

    <span class="k">except</span> <span class="nb">ZeroDivisionError</span><span class="p">:</span>
        <span class="n">logging</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="n">f</span><span class="s">"Argument b cannot be {b}"</span><span class="p">)</span>

    <span class="k">except</span> <span class="nb">TypeError</span><span class="p">:</span>
        <span class="n">logging</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="n">f</span><span class="s">"Arguments must be integers/floats"</span><span class="p">)</span>


<span class="k">print</span><span class="p">(</span><span class="n">division</span><span class="p">(</span><span class="mf">1.9</span><span class="p">,</span> <span class="mi">2</span><span class="p">))</span>
</code></pre></div></div>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>&gt;&gt;&gt; 0.95
</code></pre></div></div>

<p>You can see this function is already doing three things at once which violates the <a href="https://stackify.com/solid-design-principles/">Single Responsibility Principle</a>. SRP says that a function or class should have only one reason to change. In this case, a change in any of the three responsibilities can force the function to change. Also this means, changing or extending the function can be difficult to keep track of.</p>

<p>Instead, you can write two classes. The primary class <code class="highlighter-rouge">Division</code> will only implement the core logic while another class <code class="highlighter-rouge">ProxyDivision</code> will extend the functionality of <code class="highlighter-rouge">Division</code> by adding exception handlers and loggers.</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">import</span> <span class="nn">logging</span>
<span class="kn">from</span> <span class="nn">typing</span> <span class="kn">import</span> <span class="n">Union</span>

<span class="n">logging</span><span class="o">.</span><span class="n">basicConfig</span><span class="p">(</span><span class="n">level</span><span class="o">=</span><span class="n">logging</span><span class="o">.</span><span class="n">INFO</span><span class="p">)</span>


<span class="k">class</span> <span class="nc">Division</span><span class="p">:</span>
    <span class="k">def</span> <span class="nf">div</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">a</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="nb">float</span><span class="p">],</span> <span class="n">b</span><span class="p">:</span> <span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="nb">float</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="nb">float</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">a</span> <span class="o">/</span> <span class="n">b</span>


<span class="k">class</span> <span class="nc">ProxyDivision</span><span class="p">:</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="bp">None</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_klass</span> <span class="o">=</span> <span class="n">Division</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">div</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">a</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="nb">float</span><span class="p">],</span> <span class="n">b</span><span class="p">:</span> <span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="nb">float</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="nb">float</span><span class="p">:</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">result</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_klass</span><span class="o">.</span><span class="n">div</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">)</span>
            <span class="k">return</span> <span class="n">result</span>

        <span class="k">except</span> <span class="nb">ZeroDivisionError</span><span class="p">:</span>
            <span class="n">logging</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="n">f</span><span class="s">"Argument b cannot be {b}"</span><span class="p">)</span>

        <span class="k">except</span> <span class="nb">TypeError</span><span class="p">:</span>
            <span class="n">logging</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="n">f</span><span class="s">"Arguments must be integers/floats"</span><span class="p">)</span>


<span class="n">klass</span> <span class="o">=</span> <span class="n">ProxyDivision</span><span class="p">()</span>
<span class="k">print</span><span class="p">(</span><span class="n">klass</span><span class="o">.</span><span class="n">div</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">0</span><span class="p">))</span>
</code></pre></div></div>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>&gt;&gt;&gt; ERROR:root:Argument b cannot be 0
    None
</code></pre></div></div>

<p>In the example above, since both <code class="highlighter-rouge">Division</code> and <code class="highlighter-rouge">ProxyDivision</code> class implement the same interface, you can swap out the <code class="highlighter-rouge">Division</code> class with <code class="highlighter-rouge">ProxyDivision</code> and vice versa. The second class neither inherits directly from the first  class nor it adds any new method to it. This means you can easily write another class to extend the functionalities of <code class="highlighter-rouge">Division</code> or <code class="highlighter-rouge">DivisionProxy</code> class without touching their internal logics directly.</p>

<h3 id="enhanced-testability">
<a class="anchor" href="#enhanced-testability" aria-hidden="true"><span class="octicon octicon-link"></span></a>Enhanced Testability</h3>

<p>Another great advantage of using the proxy pattern is enhanced testability. Since your core logic is loosely coupled with the extended functionalities, you can test them out separately. This makes the test more succinct and modular. It’s easy to demonstrate the benefits with our previously mentioned <code class="highlighter-rouge">Division</code> and <code class="highlighter-rouge">ProxyDivision</code> classes. Here, the logic of the primary class is easy to follow and since this class only holds the core logic, it’s crucial to write unit test for this before testing the added functionalities. Testing out the <code class="highlighter-rouge">Division</code> class is much cleaner than testing the previously defined <code class="highlighter-rouge">division</code> function that tries to do multiple things at once. Once you’re done testing the primary class, you can proceed with the additional functionalities. Usually, this decoupling of core logic from the cruft and the encapsulation of additional functionalities result in more reliable and rigorous unit tests.</p>

<h2 id="proxy-pattern-with-interface">
<a class="anchor" href="#proxy-pattern-with-interface" aria-hidden="true"><span class="octicon octicon-link"></span></a>Proxy Pattern with Interface</h2>

<p>In the real world, your class won’t look like the simple <code class="highlighter-rouge">Division</code> class having only a single method. Usually your primary class will have multiple methods and they will carry out multiple sophisticated tasks. By now, you probably have grasped the fact that the proxy classes need to implement all of the methods of the primary class. While writing a proxy class for a complicated primary class, the author of that class might forget to implement all the methods of the primary class.This will lead to a violation of the proxy pattern. Also, it can be hard to follow all the methods of the primary class if the class is large and complicated.</p>

<p>Here, the solution is an interface that can signal the author of the proxy class about all the methods that need to be implemented. An <em>interface</em> is nothing but an abstract class that dictates all the methods a concrete class needs to implement. However, interfaces can’t be initialized independently. You’ll have to make a subclass of the interface and implement all the methods defined there. Your subclass will raise error if it fails to implement any of the methods of the interface. Let’s look at a minimal example of how you can write an interface using Python’s <code class="highlighter-rouge">abc.ABC</code> and <code class="highlighter-rouge">abc.abstractmethod</code> and achieve proxy pattern with that.</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">from</span> <span class="nn">abc</span> <span class="kn">import</span> <span class="n">ABC</span><span class="p">,</span> <span class="n">abstractmethod</span>


<span class="k">class</span> <span class="nc">Interface</span><span class="p">(</span><span class="n">ABC</span><span class="p">):</span>
    <span class="s">"""Interfaces of Interface, Concrete &amp; Proxy should
    be the same, because the client should be able to use
    Concrete or Proxy without any change in their internals.
    """</span>

    <span class="o">@</span><span class="n">abstractmethod</span>
    <span class="k">def</span> <span class="nf">job_a</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">user</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="bp">None</span><span class="p">:</span>
        <span class="k">pass</span>

    <span class="o">@</span><span class="n">abstractmethod</span>
    <span class="k">def</span> <span class="nf">job_b</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">user</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="bp">None</span><span class="p">:</span>
        <span class="k">pass</span>


<span class="k">class</span> <span class="nc">Concrete</span><span class="p">(</span><span class="n">Interface</span><span class="p">):</span>
    <span class="s">"""This is the main job doer. External services like
    payment gateways can be a good example.
    """</span>

    <span class="k">def</span> <span class="nf">job_a</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">user</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="bp">None</span><span class="p">:</span>
        <span class="k">print</span><span class="p">(</span><span class="n">f</span><span class="s">"I am doing the job_a for {user}"</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">job_b</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">user</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="bp">None</span><span class="p">:</span>
        <span class="k">print</span><span class="p">(</span><span class="n">f</span><span class="s">"I am doing the job_b for {user}"</span><span class="p">)</span>


<span class="k">class</span> <span class="nc">Proxy</span><span class="p">(</span><span class="n">Interface</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="bp">None</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_concrete</span> <span class="o">=</span> <span class="n">Concrete</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">job_a</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">user</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="bp">None</span><span class="p">:</span>
        <span class="k">print</span><span class="p">(</span><span class="n">f</span><span class="s">"I'm extending job_a for user {user}"</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">job_b</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">user</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="bp">None</span><span class="p">:</span>
        <span class="k">print</span><span class="p">(</span><span class="n">f</span><span class="s">"I'm extending job_b for user {user}"</span><span class="p">)</span>


<span class="k">if</span> <span class="n">__name__</span> <span class="o">==</span> <span class="s">"__main__"</span><span class="p">:</span>
    <span class="n">klass</span> <span class="o">=</span> <span class="n">Proxy</span><span class="p">()</span>
    <span class="k">print</span><span class="p">(</span><span class="n">klass</span><span class="o">.</span><span class="n">job_a</span><span class="p">(</span><span class="s">"red"</span><span class="p">))</span>
    <span class="k">print</span><span class="p">(</span><span class="n">klass</span><span class="o">.</span><span class="n">job_b</span><span class="p">(</span><span class="s">"nafi"</span><span class="p">))</span>
</code></pre></div></div>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>&gt;&gt;&gt; I'm extending job_a for user red
    None
    I'm extending job_b for user nafi
    None
</code></pre></div></div>

<p>It’s evident from the above workflow that you’ll need to define an <code class="highlighter-rouge">Interface</code> class first. Python provides abstract base classes as <code class="highlighter-rouge">ABC</code> in the <code class="highlighter-rouge">abc</code> module. Abstract class <code class="highlighter-rouge">Interface</code> inherits from <code class="highlighter-rouge">ABC</code> and defines all the methods that the concrete class will have to implement later. <code class="highlighter-rouge">Concrete</code> class inherits from the interface and implements all the methods defined in it. Notice how each method in the <code class="highlighter-rouge">Interface</code> class is decorated with the <code class="highlighter-rouge">@abstractmethod</code> decorator. If your knowledge on decorator is fuzzy, then checkout <a href="https://rednafi.github.io/digressions/python/2020/05/13/python-decorators">this</a> post on Python decorators. The <code class="highlighter-rouge">@abstractmethod</code> decorator turns a normal method into an abstract method which means that the method is nothing but a blueprint of the required methods that the concrete subclass will have to implement later. You can’t directly instantiate <code class="highlighter-rouge">Interface</code> or use any of the abstract methods without making subclasses of the interface and implementing the methods.</p>

<p>The second class <code class="highlighter-rouge">Concrete</code> is the actual class that inherits from the abstract base class (interface) <code class="highlighter-rouge">Interface</code> and implements all the methods mentioned as abstract methods. This is a real class that you can instantiate and the methods can be used directly. However, if you forget to implement any of the abstract methods defined in the <code class="highlighter-rouge">Interface</code> then you’ll invoke <code class="highlighter-rouge">TypeError</code>.</p>

<p>The third class <code class="highlighter-rouge">Proxy</code> extends the functionalities of the base concrete class <code class="highlighter-rouge">Concrete</code>. It calls the <code class="highlighter-rouge">Concrete</code> class using the composition pattern and implements all the methods. However, in this case, I used the results from the concrete methods and extended their functionalities without code duplication.</p>

<h2 id="another-practical-example">
<a class="anchor" href="#another-practical-example" aria-hidden="true"><span class="octicon octicon-link"></span></a>Another Practical Example</h2>

<p>Let’s play around with one last real-world example to concretize the concept. Suppose, you want to collect data from an external API endpoint. To do so, you hit the endpoint with <code class="highlighter-rouge">GET</code> requests from your http client and collect the responses in <code class="highlighter-rouge">json</code> format. Then say, you also want to inspect the response <code class="highlighter-rouge">header</code> and the <code class="highlighter-rouge">arguments</code> that were passed while making the request.</p>

<p>Now, in the real world, public APIs will often impose rate limits and when you go over the limit with multiple get requests, your client will likely throw an http connection-timeout error. Say, you want to handle this exceptions outside of the core logic that will send the http <code class="highlighter-rouge">GET</code> requests.</p>

<p>Again, let’s say you also want to cache the responses if the client has seen the arguments in the requests before. This means, when you send requests with the same arguments multiple times, instead of hitting the APIs with redundant requests, the client will show you the responses from the cache. Caching improves API response time dramatically.</p>

<p>For this demonstration, I’ll be using Postman’s publicly available <code class="highlighter-rouge">GET</code> API.</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>https://postman-echo.com/get?foo1=bar_1&amp;foo2=bar_2
</code></pre></div></div>

<p>This API is perfect for the demonstration since it has a rate limiter that kicks in arbitrarily and make the client throw <code class="highlighter-rouge">ConnectTimeOut</code> and <code class="highlighter-rouge">ReadTimeOutError</code>. See how this workflow is going to look like:</p>

<ul>
  <li>
    <p>Define an interface called <code class="highlighter-rouge">IFetchUrl</code> that will implement three abstract methods. The first method <code class="highlighter-rouge">get_data</code> will fetch data from the URL and serialize them into <code class="highlighter-rouge">json</code> format. The second method <code class="highlighter-rouge">get_headers</code> will probe the data and return the header as a dictionary. The third method <code class="highlighter-rouge">get_args</code> will also probe the data like the second method but this time it will return the query arguments as a dictionary. However, in the interface, you won’t be implementing anything inside the methods.</p>
  </li>
  <li>
    <p>Make a concrete class named <code class="highlighter-rouge">FetchUrl</code> that will derive from interface <code class="highlighter-rouge">IFetchUrl</code>. This time you’ll implement all three methods defined in the abstract class. However, you shouldn’t handle any edge cases here. The method should contain pure logic flow without any extra fluff.</p>
  </li>
  <li>
    <p>Make a proxy class called <code class="highlighter-rouge">ExcFetchUrl</code>. It will also inherit from the interface but this time you’ll add your exception handling logics here. This class also adds logging functionality to all the methods. Here you call the concrete class <code class="highlighter-rouge">FetchUrl</code> in a composition format and avoid code repetition by using the methods that’s been already implemented in the concrete class. Like the <code class="highlighter-rouge">FetchUrl</code> class, here too, you’ve to implement all the methods found in the abstract class.</p>
  </li>
  <li>
    <p>The fourth and the final class will extend the <code class="highlighter-rouge">ExcFetchUrl</code> and add caching functionality to the <code class="highlighter-rouge">get_data</code> method. It will follow the same pattern as the <code class="highlighter-rouge">ExcFetchUrl</code> class.</p>
  </li>
</ul>

<p>Since, by now, you’re already familiar with the workflow of the proxy pattern, let’s dump the entire 110 line solution all at once.</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">import</span> <span class="nn">logging</span>
<span class="kn">import</span> <span class="nn">sys</span>
<span class="kn">from</span> <span class="nn">abc</span> <span class="kn">import</span> <span class="n">ABC</span><span class="p">,</span> <span class="n">abstractmethod</span>
<span class="kn">from</span> <span class="nn">datetime</span> <span class="kn">import</span> <span class="n">datetime</span>
<span class="kn">from</span> <span class="nn">pprint</span> <span class="kn">import</span> <span class="n">pprint</span>

<span class="kn">import</span> <span class="nn">httpx</span>
<span class="kn">from</span> <span class="nn">httpx._exceptions</span> <span class="kn">import</span> <span class="n">ConnectTimeout</span><span class="p">,</span> <span class="n">ReadTimeout</span>
<span class="kn">from</span> <span class="nn">functools</span> <span class="kn">import</span> <span class="n">lru_cache</span>


<span class="n">logging</span><span class="o">.</span><span class="n">basicConfig</span><span class="p">(</span><span class="n">level</span><span class="o">=</span><span class="n">logging</span><span class="o">.</span><span class="n">INFO</span><span class="p">)</span>


<span class="k">class</span> <span class="nc">IFetchUrl</span><span class="p">(</span><span class="n">ABC</span><span class="p">):</span>
    <span class="s">"""Abstract base class. You can't instantiate this independently."""</span>

    <span class="o">@</span><span class="n">abstractmethod</span>
    <span class="k">def</span> <span class="nf">get_data</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">url</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">:</span>
        <span class="k">pass</span>

    <span class="o">@</span><span class="n">abstractmethod</span>
    <span class="k">def</span> <span class="nf">get_headers</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">data</span><span class="p">:</span> <span class="nb">dict</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">:</span>
        <span class="k">pass</span>

    <span class="o">@</span><span class="n">abstractmethod</span>
    <span class="k">def</span> <span class="nf">get_args</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">data</span><span class="p">:</span> <span class="nb">dict</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">:</span>
        <span class="k">pass</span>


<span class="k">class</span> <span class="nc">FetchUrl</span><span class="p">(</span><span class="n">IFetchUrl</span><span class="p">):</span>
    <span class="s">"""Concrete class that doesn't handle exceptions and loggings."""</span>

    <span class="k">def</span> <span class="nf">get_data</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">url</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">:</span>
        <span class="k">with</span> <span class="n">httpx</span><span class="o">.</span><span class="n">Client</span><span class="p">()</span> <span class="k">as</span> <span class="n">client</span><span class="p">:</span>
            <span class="n">response</span> <span class="o">=</span> <span class="n">client</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">url</span><span class="p">)</span>
            <span class="n">data</span> <span class="o">=</span> <span class="n">response</span><span class="o">.</span><span class="n">json</span><span class="p">()</span>
            <span class="k">return</span> <span class="n">data</span>

    <span class="k">def</span> <span class="nf">get_headers</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">data</span><span class="p">:</span> <span class="nb">dict</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">data</span><span class="p">[</span><span class="s">"headers"</span><span class="p">]</span>

    <span class="k">def</span> <span class="nf">get_args</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">data</span><span class="p">:</span> <span class="nb">dict</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">data</span><span class="p">[</span><span class="s">"args"</span><span class="p">]</span>


<span class="k">class</span> <span class="nc">ExcFetchUrl</span><span class="p">(</span><span class="n">IFetchUrl</span><span class="p">):</span>
    <span class="s">"""This class can be swapped out with the FetchUrl class.
    It provides additional exception handling and logging."""</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="bp">None</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_fetch_url</span> <span class="o">=</span> <span class="n">FetchUrl</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">get_data</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">url</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">:</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">data</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_fetch_url</span><span class="o">.</span><span class="n">get_data</span><span class="p">(</span><span class="n">url</span><span class="p">)</span>
            <span class="k">return</span> <span class="n">data</span>

        <span class="k">except</span> <span class="n">ConnectTimeout</span><span class="p">:</span>
            <span class="n">logging</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="s">"Connection time out. Try again later."</span><span class="p">)</span>
            <span class="n">sys</span><span class="o">.</span><span class="nb">exit</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>

        <span class="k">except</span> <span class="n">ReadTimeout</span><span class="p">:</span>
            <span class="n">logging</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="s">"Read timed out. Try again later."</span><span class="p">)</span>
            <span class="n">sys</span><span class="o">.</span><span class="nb">exit</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">get_headers</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">data</span><span class="p">:</span> <span class="nb">dict</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">:</span>
        <span class="n">headers</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_fetch_url</span><span class="o">.</span><span class="n">get_headers</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
        <span class="n">logging</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="n">f</span><span class="s">"Getting the headers at {datetime.now()}"</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">headers</span>

    <span class="k">def</span> <span class="nf">get_args</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">data</span><span class="p">:</span> <span class="nb">dict</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">:</span>
        <span class="n">args</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_fetch_url</span><span class="o">.</span><span class="n">get_args</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
        <span class="n">logging</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="n">f</span><span class="s">"Getting the args at {datetime.now()}"</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">args</span>


<span class="k">class</span> <span class="nc">CacheFetchUrl</span><span class="p">(</span><span class="n">IFetchUrl</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="bp">None</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_fetch_url</span> <span class="o">=</span> <span class="n">ExcFetchUrl</span><span class="p">()</span>

    <span class="o">@</span><span class="n">lru_cache</span><span class="p">(</span><span class="n">maxsize</span><span class="o">=</span><span class="mi">32</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">get_data</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">url</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">:</span>
        <span class="n">data</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_fetch_url</span><span class="o">.</span><span class="n">get_data</span><span class="p">(</span><span class="n">url</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">data</span>

    <span class="k">def</span> <span class="nf">get_headers</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">data</span><span class="p">:</span> <span class="nb">dict</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">:</span>
        <span class="n">headers</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_fetch_url</span><span class="o">.</span><span class="n">get_headers</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">headers</span>

    <span class="k">def</span> <span class="nf">get_args</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">data</span><span class="p">:</span> <span class="nb">dict</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">:</span>
        <span class="n">args</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_fetch_url</span><span class="o">.</span><span class="n">get_args</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">args</span>


<span class="k">if</span> <span class="n">__name__</span> <span class="o">==</span> <span class="s">"__main__"</span><span class="p">:</span>

    <span class="c1"># url = "https://postman-echo.com/get?foo1=bar_1&amp;foo2=bar_2"
</span>
    <span class="n">fetch</span> <span class="o">=</span> <span class="n">CacheFetchUrl</span><span class="p">()</span>
    <span class="k">for</span> <span class="n">arg1</span><span class="p">,</span> <span class="n">arg2</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">([</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">],</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">]):</span>
        <span class="n">url</span> <span class="o">=</span> <span class="n">f</span><span class="s">"https://postman-echo.com/get?foo1=bar_{arg1}&amp;foo2=bar_{arg2}"</span>
        <span class="k">print</span><span class="p">(</span><span class="n">f</span><span class="s">"</span><span class="se">\n</span><span class="s"> {'-'*75}</span><span class="se">\n</span><span class="s">"</span><span class="p">)</span>
        <span class="n">data</span> <span class="o">=</span> <span class="n">fetch</span><span class="o">.</span><span class="n">get_data</span><span class="p">(</span><span class="n">url</span><span class="p">)</span>
        <span class="k">print</span><span class="p">(</span><span class="n">f</span><span class="s">"Cache Info: {fetch.get_data.cache_info()}"</span><span class="p">)</span>
        <span class="n">pprint</span><span class="p">(</span><span class="n">fetch</span><span class="o">.</span><span class="n">get_headers</span><span class="p">(</span><span class="n">data</span><span class="p">))</span>
        <span class="n">pprint</span><span class="p">(</span><span class="n">fetch</span><span class="o">.</span><span class="n">get_args</span><span class="p">(</span><span class="n">data</span><span class="p">))</span>
</code></pre></div></div>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>---------------------------------------------------------------------------

INFO:root:Getting the headers at 2020-06-16 16:54:36.214562
INFO:root:Getting the args at 2020-06-16 16:54:36.220221
Cache Info: CacheInfo(hits=0, misses=1, maxsize=32, currsize=1)
{'accept': '*/*',
    'accept-encoding': 'gzip, deflate',
    'content-length': '0',
    'host': 'postman-echo.com',
    'user-agent': 'python-httpx/0.13.1',
    'x-amzn-trace-id': 'Root=1-5ee8a4eb-4341ae58365e4090660dfaa4',
    'x-b3-parentspanid': '044bd10726921994',
    'x-b3-sampled': '0',
    'x-b3-spanid': '503e6ceaa2a4f493',
    'x-b3-traceid': '77d5b03fe98fcc1a044bd10726921994',
    'x-envoy-external-address': '10.100.91.201',
    'x-forwarded-client-cert': 'By=spiffe://cluster.local/ns/pm-echo-istio/sa/default;Hash=2ed845a68a0968c80e6e0d0f49dec5ce15ee3c1f87408e56c938306f2129528b;Subject="";URI=spiffe://cluster.local/ns/istio-system/sa/istio-ingressgateway-service-account',
    'x-forwarded-port': '443',
    'x-forwarded-proto': 'http',
    'x-request-id': '295d0b6c-7aa0-4481-aa4d-f47f5eac7d57'}
{'foo1': 'bar_1', 'foo2': 'bar_1'}

....
</code></pre></div></div>

<p>In the <code class="highlighter-rouge">get_data</code> method of the <code class="highlighter-rouge">FetchUrl</code> class, I’ve used the awesome <a href="https://github.com/encode/httpx">httpx</a> client to fetch the data from the URL. Pay attention to the fact that I’ve practically ignored all the additional logics of error handling and logging here.
The exception handling and logging logics were added via <code class="highlighter-rouge">ExcFetchUrl</code> proxy class. Another class <code class="highlighter-rouge">CacheFetchUrl</code> further extents the proxy class <code class="highlighter-rouge">ExcFetchUrl</code> by adding cache functionality to the <code class="highlighter-rouge">get_data</code> method.</p>

<p>In the main section, you can use any of the <code class="highlighter-rouge">FetchUrl</code>, <code class="highlighter-rouge">ExcFetchUrl</code> or <code class="highlighter-rouge">CacheFetchUrl</code> without any additional changes to the logic of these classes. The <code class="highlighter-rouge">FetchUrl</code> is the barebone class that will fail in case of the occurrence of any exceptions. The later classes appends additional functionalities while maintaining the same interface.</p>

<p>The output basically prints out the results returned by the <code class="highlighter-rouge">get_headers</code> and <code class="highlighter-rouge">get_args</code> methods. Also notice, how I picked the endpoint arguments to simulate caching. The <code class="highlighter-rouge">Cache Info:</code> on the third line of the output shows when data is served from the cache. Here <code class="highlighter-rouge">hits=0</code> means data is served directly from the external API. However, if you inspect the later outputs, you’ll see when the query arguments get repeated ([1, 2, 3, 1, 2, 3]), <code class="highlighter-rouge">Cache Info:</code> will show higher hit counts. This means that the data is being served from the cache.</p>

<h2 id="should-you-use-it">
<a class="anchor" href="#should-you-use-it" aria-hidden="true"><span class="octicon octicon-link"></span></a>Should You Use It?</h2>

<p>Well, yes obviously. But not always. You see, you need a little bit of planning before orchestrating declarative solution with the proxy pattern. It’s not viable to write code in this manner in a throwaway script that you don’t have to maintain in the long run. Also, this OOP-cursed additional layers of abstraction can make your code subjectively unreadable. So use the pattern wisely. On the flip side, proxy pattern can come extremely handy when you need to extend the functionality of some class arbitrarily as it can work a gateway to the El Dorado of loose coupling.</p>

<h2 id="remarks">
<a class="anchor" href="#remarks" aria-hidden="true"><span class="octicon octicon-link"></span></a>Remarks</h2>

<p>All the pieces of codes in the blog were written and tested with python 3.8 on a machine running Ubuntu 18.04.</p>

<h2 id="references">
<a class="anchor" href="#references" aria-hidden="true"><span class="octicon octicon-link"></span></a>References</h2>

<ul>
  <li><a href="https://github.com/faif/python-patterns">Python Patterns</a></li>
  <li><a href="https://github.com/kamranahmedse/design-patterns-for-humans">Design Patterns for Humans</a></li>
  <li><a href="https://refactoring.guru/design-patterns/proxy/python/example">Design Patterns- Refactoring Guru</a></li>
  <li><a href="https://python-3-patterns-idioms-test.readthedocs.io/en/latest/Fronting.html">Design Patterns &amp; Idioms</a></li>
</ul>

  </div><!-- from https://github.com/utterance/utterances -->
<script src="https://utteranc.es/client.js"
        repo="rednafi/digressions"
        issue-term="title"
        label="blogpost-comment"
        theme="github-light"
        crossorigin="anonymous"
        async>
</script><a class="u-url" href="/digressions/python/2020/06/16/python-proxy-pattern.html" hidden></a>
</article>

      </div>
    </main><footer class="site-footer h-card">
  <data class="u-url" href="/digressions/"></data>

  <div class="wrapper">

    <div class="footer-col-wrapper">
      <div class="footer-col">
        <p class="feed-subscribe">
          <a href="/digressions/feed.xml">
            <svg class="svg-icon orange">
              <use xlink:href="/digressions/assets/minima-social-icons.svg#rss"></use>
            </svg><span>Subscribe</span>
          </a>
        </p>
      </div>
      <div class="footer-col">
        <p>Sporadic cogitations on software, tech &amp; personal beliefs</p>
      </div>
    </div>

    <div class="social-links"><ul class="social-media-list"><li><a rel="me" href="https://github.com/rednafi" title="rednafi"><svg class="svg-icon grey"><use xlink:href="/digressions/assets/minima-social-icons.svg#github"></use></svg></a></li><li><a rel="me" href="https://twitter.com/rednafi" title="rednafi"><svg class="svg-icon grey"><use xlink:href="/digressions/assets/minima-social-icons.svg#twitter"></use></svg></a></li></ul>
</div>

  </div>

</footer>
</body>

</html>
