<!DOCTYPE html>
<html lang="en"><head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1"><!-- Begin Jekyll SEO tag v2.6.1 -->
<title>Interfaces, Mixins and Building Powerful Custom Data Structures in Python | Red’s Digressions</title>
<meta name="generator" content="Jekyll v4.0.0" />
<meta property="og:title" content="Interfaces, Mixins and Building Powerful Custom Data Structures in Python" />
<meta property="og:locale" content="en_US" />
<meta name="description" content="Supercharging Python’s built-in data structures" />
<meta property="og:description" content="Supercharging Python’s built-in data structures" />
<link rel="canonical" href="https://rednafi.github.io/digressions/python/2020/07/03/python-mixins.html" />
<meta property="og:url" content="https://rednafi.github.io/digressions/python/2020/07/03/python-mixins.html" />
<meta property="og:site_name" content="Red’s Digressions" />
<meta property="og:type" content="article" />
<meta property="article:published_time" content="2020-07-03T00:00:00-05:00" />
<script type="application/ld+json">
{"datePublished":"2020-07-03T00:00:00-05:00","headline":"Interfaces, Mixins and Building Powerful Custom Data Structures in Python","description":"Supercharging Python’s built-in data structures","mainEntityOfPage":{"@type":"WebPage","@id":"https://rednafi.github.io/digressions/python/2020/07/03/python-mixins.html"},"@type":"BlogPosting","url":"https://rednafi.github.io/digressions/python/2020/07/03/python-mixins.html","dateModified":"2020-07-03T00:00:00-05:00","@context":"https://schema.org"}</script>
<!-- End Jekyll SEO tag -->
<link rel="stylesheet" href="/digressions/assets/css/style.css"><link type="application/atom+xml" rel="alternate" href="https://rednafi.github.io/digressions/feed.xml" title="Red's Digressions" /><!-- the google_analytics_id gets auto inserted from the config file -->



<script>(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)})(window,document,'script','//www.google-analytics.com/analytics.js','ga');ga('create','UA-160409032-1','auto');ga('require','displayfeatures');ga('send','pageview');</script>

<link rel="shortcut icon" type="image/x-icon" href="/digressions/images/favicon.ico"><!-- Begin Jekyll SEO tag v2.6.1 -->
<title>Interfaces, Mixins and Building Powerful Custom Data Structures in Python | Red’s Digressions</title>
<meta name="generator" content="Jekyll v4.0.0" />
<meta property="og:title" content="Interfaces, Mixins and Building Powerful Custom Data Structures in Python" />
<meta property="og:locale" content="en_US" />
<meta name="description" content="Supercharging Python’s built-in data structures" />
<meta property="og:description" content="Supercharging Python’s built-in data structures" />
<link rel="canonical" href="https://rednafi.github.io/digressions/python/2020/07/03/python-mixins.html" />
<meta property="og:url" content="https://rednafi.github.io/digressions/python/2020/07/03/python-mixins.html" />
<meta property="og:site_name" content="Red’s Digressions" />
<meta property="og:type" content="article" />
<meta property="article:published_time" content="2020-07-03T00:00:00-05:00" />
<script type="application/ld+json">
{"datePublished":"2020-07-03T00:00:00-05:00","headline":"Interfaces, Mixins and Building Powerful Custom Data Structures in Python","description":"Supercharging Python’s built-in data structures","mainEntityOfPage":{"@type":"WebPage","@id":"https://rednafi.github.io/digressions/python/2020/07/03/python-mixins.html"},"@type":"BlogPosting","url":"https://rednafi.github.io/digressions/python/2020/07/03/python-mixins.html","dateModified":"2020-07-03T00:00:00-05:00","@context":"https://schema.org"}</script>
<!-- End Jekyll SEO tag -->

<link href="https://unpkg.com/@primer/css/dist/primer.css" rel="stylesheet" />
<link rel="stylesheet" href="//use.fontawesome.com/releases/v5.0.7/css/all.css"><link type="application/atom+xml" rel="alternate" href="https://rednafi.github.io/digressions/feed.xml" title="Red's Digressions" /><!-- the google_analytics_id gets auto inserted from the config file -->



<script>(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)})(window,document,'script','//www.google-analytics.com/analytics.js','ga');ga('create','UA-160409032-1','auto');ga('require','displayfeatures');ga('send','pageview');</script>


    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.11.1/dist/katex.min.css" integrity="sha384-zB1R0rpPzHqg7Kpt0Aljp8JPLqbXI3bhnPWROx27a9N0Ll6ZP/+DiW/UqRcLbRjq" crossorigin="anonymous">
    <script type="text/javascript" async src="https://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-MML-AM_CHTML"> </script>
    <script defer src="https://cdn.jsdelivr.net/npm/katex@0.11.1/dist/katex.min.js" integrity="sha384-y23I5Q6l+B6vatafAwxRu/0oK/79VlbSz7Q9aiSZUvyWYIYsd+qj+o24G5ZU2zJz" crossorigin="anonymous"></script>
    <script defer src="https://cdn.jsdelivr.net/npm/katex@0.11.1/dist/contrib/auto-render.min.js" integrity="sha384-kWPLUVMOks5AQFrykwIup5lo0m3iMkkHrD0uJ4H5cjeGihAutqP0yW0J6dpFiVkI" crossorigin="anonymous"></script>
    <script>
    document.addEventListener("DOMContentLoaded", function() {
        renderMathInElement( document.body, {
        delimiters: [
            {left: "$$", right: "$$", display: true},
            {left: "[%", right: "%]", display: true},
            {left: "$", right: "$", display: false}
        ]}
        );
    });
    </script>


<script>
function wrap_img(fn) {
    if (document.attachEvent ? document.readyState === "complete" : document.readyState !== "loading") {
        var elements = document.querySelectorAll(".post img");
        Array.prototype.forEach.call(elements, function(el, i) {
            if (el.getAttribute("title")) {
                const caption = document.createElement('figcaption');
                var node = document.createTextNode(el.getAttribute("title"));
                caption.appendChild(node);
                const wrapper = document.createElement('figure');
                wrapper.className = 'image';
                el.parentNode.insertBefore(wrapper, el);
                el.parentNode.removeChild(el);
                wrapper.appendChild(el);
                wrapper.appendChild(caption);
            }
        });
    } else { document.addEventListener('DOMContentLoaded', fn); }
}
window.onload = wrap_img;
</script>

<script>
    document.addEventListener("DOMContentLoaded", function(){
    // add link icon to anchor tags
    var elem = document.querySelectorAll(".anchor-link")
    elem.forEach(e => (e.innerHTML = '<i class="fas fa-link fa-xs"></i>'));
    });
</script>
</head><body><header class="site-header">

  <div class="wrapper"><a class="site-title" rel="author" href="/digressions/">Red&#39;s Digressions</a><nav class="site-nav">
        <input type="checkbox" id="nav-trigger" class="nav-trigger" />
        <label for="nav-trigger">
          <span class="menu-icon">
            <svg viewBox="0 0 18 15" width="18px" height="15px">
              <path d="M18,1.484c0,0.82-0.665,1.484-1.484,1.484H1.484C0.665,2.969,0,2.304,0,1.484l0,0C0,0.665,0.665,0,1.484,0 h15.032C17.335,0,18,0.665,18,1.484L18,1.484z M18,7.516C18,8.335,17.335,9,16.516,9H1.484C0.665,9,0,8.335,0,7.516l0,0 c0-0.82,0.665-1.484,1.484-1.484h15.032C17.335,6.031,18,6.696,18,7.516L18,7.516z M18,13.516C18,14.335,17.335,15,16.516,15H1.484 C0.665,15,0,14.335,0,13.516l0,0c0-0.82,0.665-1.483,1.484-1.483h15.032C17.335,12.031,18,12.695,18,13.516L18,13.516z"/>
            </svg>
          </span>
        </label>

        <div class="trigger"><a class="page-link" href="/digressions/about/">About Me</a><a class="page-link" href="/digressions/search/">Search</a><a class="page-link" href="/digressions/categories/">Tags</a></div>
      </nav></div>
</header>
<main class="page-content" aria-label="Content">
      <div class="wrapper">
        <article class="post h-entry" itemscope itemtype="http://schema.org/BlogPosting">

  <header class="post-header">
    <h1 class="post-title p-name" itemprop="name headline">Interfaces, Mixins and Building Powerful Custom Data Structures in Python
    </h1><p class="page-description">Supercharging Python&#39;s built-in data structures</p><p class="post-meta post-meta-title"><time class="dt-published" datetime="2020-07-03T00:00:00-05:00"
        itemprop="datePublished">
        Jul 3, 2020
      </time>
      • <span class="read-time" title="Estimated read time">
    
    
      34 min read
    
</span></p>

    
    <p class="category-tags"><i class="fas fa-tags category-tags-icon"></i></i>
      
      <a class="category-tags-link"
        href="/digressions/categories/#Python">Python</a>
      
      
    </p>
    

    </header>

  <div class="post-content e-content" itemprop="articleBody">
    <ul class="section-nav">
<li class="toc-entry toc-h2"><a href="#concept-edifice">Concept Edifice</a></li>
<li class="toc-entry toc-h2"><a href="#interfaces">Interfaces</a>
<ul>
<li class="toc-entry toc-h3"><a href="#overview">Overview</a></li>
</ul>
</li>
<li class="toc-entry toc-h2"><a href="#informal-interfaces">Informal Interfaces</a></li>
<li class="toc-entry toc-h2"><a href="#formal-interfaces">Formal Interfaces</a>
<ul>
<li class="toc-entry toc-h3"><a href="#interfaces-vs-abstract-base-classes">Interfaces vs Abstract Base Classes</a></li>
<li class="toc-entry toc-h3"><a href="#a-complete-example">A Complete Example</a></li>
</ul>
</li>
<li class="toc-entry toc-h2"><a href="#mixins">Mixins</a>
<ul>
<li class="toc-entry toc-h3"><a href="#overview-1">Overview</a></li>
<li class="toc-entry toc-h3"><a href="#differences-between-interfaces-abstract-classes-and-mixins">Differences Between Interfaces, Abstract Classes and Mixins</a></li>
<li class="toc-entry toc-h3"><a href="#a-complete-example-1">A Complete Example</a></li>
</ul>
</li>
<li class="toc-entry toc-h2"><a href="#building-powerful-custom-data-structures-with-mixins">Building Powerful Custom Data Structures with Mixins</a>
<ul>
<li class="toc-entry toc-h3"><a href="#verbose-tuple">Verbose Tuple</a></li>
<li class="toc-entry toc-h3"><a href="#verbose-list">Verbose List</a></li>
<li class="toc-entry toc-h3"><a href="#verbose-frozen-dict">Verbose Frozen Dict</a></li>
<li class="toc-entry toc-h3"><a href="#verbose-dict">Verbose Dict</a></li>
</ul>
</li>
<li class="toc-entry toc-h2"><a href="#going-ballistic-with-custom-data-structures">Going Ballistic with Custom Data Structures</a>
<ul>
<li class="toc-entry toc-h3"><a href="#bitset">BitSet</a></li>
<li class="toc-entry toc-h3"><a href="#sqlalchemydict">SQLAlchemyDict</a></li>
</ul>
</li>
<li class="toc-entry toc-h2"><a href="#remarks">Remarks</a></li>
<li class="toc-entry toc-h2"><a href="#references">References</a></li>
</ul><p>Imagine a custom <em>set-like</em> data structure that doesn’t perform hashing and trades performance for tighter memory footprint. Or imagine a <em>dict-like</em> data structure that automatically stores data in a PostgreSQL or Redis database the moment you initialize it; also it lets you to <em>get-set-delete</em> key-value pairs using the usual <em>retrieval-assignment-deletion</em> syntax associated with built-in dictionaries. Custom data structures can give you the power of choice and writing them will make you understand how the built-in data structures in Python are constructed.</p>

<p>One way to understand how built-in objects like dictionary, list, set etc work is to build custom data structures based on them. Python provides several mixin classes in the <code class="highlighter-rouge">collection.abc</code> module to design custom data structures that look and act like built-in structures with additional functionalities baked in.</p>

<h2 id="concept-edifice">
<a class="anchor" href="#concept-edifice" aria-hidden="true"><span class="octicon octicon-link"></span></a>Concept Edifice</h2>

<p>To understand how all these work, you’ll need a fair bit of knowledge about Interfaces, Abstract Base Classes, Mixin Classes etc. I’ll build the concept edifice layer by layer where you’ll learn about interfaces first and how they can be created and used via the <code class="highlighter-rouge">abc.ABC</code> class. Then you’ll learn how abstract base classes differ from interfaces. After that I’ll introduce mixins and explain how all these concepts can be knitted together to architect custom data structures with amazing capabilities. Let’s dive in.</p>

<h2 id="interfaces">
<a class="anchor" href="#interfaces" aria-hidden="true"><span class="octicon octicon-link"></span></a>Interfaces</h2>

<p>Python interfaces can help you write classes based on common structures. They ensure that classes that provide similar functionalities will also have similar footprints. Interfaces are not as popular in Python as they are in other statically typed language. The dynamic nature and duck-typing capabilities of Python often make them redundant.</p>

<p>However, in larger applications, interfaces can make you avoid writing code that is poorly encapsulated or build classes that look awfully similar but provide completely unrelated functionalities. Moreover, interfaces implicitly spawn other powerful techniques like mixin classes which can help you achieve DRY nirvana.</p>

<h3 id="overview">
<a class="anchor" href="#overview" aria-hidden="true"><span class="octicon octicon-link"></span></a>Overview</h3>

<p>At a high level, an interface acts as a blueprint for designing classes. In Python, an interface is basically a specialized abstract class that defines one or more abstract methods. Abstract classes differs from concrete classes in the sense that they aren’t intended to stand on their own and the methods they define shouldn’t have any implementation.</p>

<p>Usually, you inherit from an interface and implement the methods defined in the abstract class in a concrete subclass. Interfaces provide the skeletons and concrete classes provide the implementation of the methods based on those skeletons. Depending on the ways you can architect interfaces, they can be segmented into two primary categories.</p>

<ul>
  <li>Informal Interfaces</li>
  <li>Formal Interfaces</li>
</ul>

<h2 id="informal-interfaces">
<a class="anchor" href="#informal-interfaces" aria-hidden="true"><span class="octicon octicon-link"></span></a>Informal Interfaces</h2>

<p>Informal interfaces are classes which define methods that can be overridden, but there’s no strict enforcement.</p>

<p>Let’s write an informal interface for a simple calculator class:</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">class</span> <span class="nc">ICalc</span><span class="p">:</span>
    <span class="s">"""Informal Interface: Abstract calculator class."""</span>

    <span class="k">def</span> <span class="nf">add</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">):</span>
        <span class="k">raise</span> <span class="nb">NotImplementedError</span>

    <span class="k">def</span> <span class="nf">sub</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">):</span>
        <span class="k">raise</span> <span class="nb">NotImplementedError</span>

    <span class="k">def</span> <span class="nf">mul</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">):</span>
        <span class="k">raise</span> <span class="nb">NotImplementedError</span>

    <span class="k">def</span> <span class="nf">div</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">):</span>
        <span class="k">raise</span> <span class="nb">NotImplementedError</span>
</code></pre></div></div>

<p>Notice that the <code class="highlighter-rouge">ICalc</code> class has four different methods that don’t give you any implementation. It’s an informal interface because you can still instantiate the class but the methods will raise <code class="highlighter-rouge">NotImplementedError</code> if you try to apply them. You’ve to subclass the interface to use it. Let’s do it:</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">class</span> <span class="nc">Calc</span><span class="p">(</span><span class="n">ICalc</span><span class="p">):</span>
    <span class="s">"""Concrete Class: Calculator"""</span>

    <span class="k">def</span> <span class="nf">add</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">a</span> <span class="o">+</span> <span class="n">b</span>

    <span class="k">def</span> <span class="nf">sub</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">a</span> <span class="o">-</span> <span class="n">b</span>

    <span class="k">def</span> <span class="nf">mul</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">a</span> <span class="o">*</span> <span class="n">b</span>

    <span class="k">def</span> <span class="nf">div</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">a</span> <span class="o">/</span> <span class="n">b</span>


<span class="c1"># Using the class
</span><span class="n">c</span> <span class="o">=</span> <span class="n">Calc</span><span class="p">()</span>
<span class="k">print</span><span class="p">(</span><span class="n">c</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">))</span>
<span class="k">print</span><span class="p">(</span><span class="n">c</span><span class="o">.</span><span class="n">sub</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">))</span>
<span class="k">print</span><span class="p">(</span><span class="n">c</span><span class="o">.</span><span class="n">mul</span><span class="p">(</span><span class="mi">4</span><span class="p">,</span> <span class="mi">5</span><span class="p">))</span>
<span class="k">print</span><span class="p">(</span><span class="n">c</span><span class="o">.</span><span class="n">div</span><span class="p">(</span><span class="mi">5</span><span class="p">,</span> <span class="mi">6</span><span class="p">))</span>
</code></pre></div></div>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>3
-1
20
0.8333333333333334
</code></pre></div></div>

<p>Now, you might be wondering why you even need all of these boilerplate code and inheritance when you can directly define the concrete <code class="highlighter-rouge">Calc</code> class and call it a day.</p>

<p>Consider the following scenario where you want to add additional functionalities to each of the method of the <code class="highlighter-rouge">Calc</code> class. Here, you’ve two options. Either you can mutate the original class and add those extra functionalities to the methods or you can create another class with similar footprint and implement all the methods with the added functionalities.</p>

<p>The first option isn’t always viable and can cause regression in real life scenario. The second approach ensures modularity and is generally quicker to implement since you won’t have to worry about messing up the original concrete class. However, figuring out which methods you’ll need to implement in the extended class can be hard because the concrete class might have additional methods that you don’t want in the extended class.</p>

<p>In this case, instead of figuring out the methods from the concrete <code class="highlighter-rouge">Calc</code> class, it’s easier to do so from an established structure defined in the <code class="highlighter-rouge">ICalc</code> interface. Interfaces make the process of extending class functionalities more tractable. Let’s make another class that will add logging to all of the methods of the <code class="highlighter-rouge">Calc</code> class:</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">import</span> <span class="nn">logging</span>

<span class="n">logging</span><span class="o">.</span><span class="n">basicConfig</span><span class="p">(</span><span class="n">level</span><span class="o">=</span><span class="n">logging</span><span class="o">.</span><span class="n">INFO</span><span class="p">)</span>


<span class="k">class</span> <span class="nc">CalcLog</span><span class="p">(</span><span class="n">ICalc</span><span class="p">):</span>
    <span class="s">"""Concrete Class: Calculator with logging"""</span>

    <span class="k">def</span> <span class="nf">add</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">):</span>
        <span class="n">logging</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="n">f</span><span class="s">"Operation: Addition, Arguments: {(a, b)}"</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">a</span> <span class="o">+</span> <span class="n">b</span>

    <span class="k">def</span> <span class="nf">sub</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">):</span>
        <span class="n">logging</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="n">f</span><span class="s">"Operation: Subtraction, Arguments: {(a, b)}"</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">a</span> <span class="o">-</span> <span class="n">b</span>

    <span class="k">def</span> <span class="nf">mul</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">):</span>
        <span class="n">logging</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="n">f</span><span class="s">"Operation: Multiplication, Arguments: {(a, b)}"</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">a</span> <span class="o">*</span> <span class="n">b</span>

    <span class="k">def</span> <span class="nf">div</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">):</span>
        <span class="n">logging</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="n">f</span><span class="s">"Operation: Division, Arguments: {(a, b)}"</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">a</span> <span class="o">/</span> <span class="n">b</span>


<span class="c1"># Using the class
</span><span class="n">clog</span> <span class="o">=</span> <span class="n">CalcLog</span><span class="p">()</span>
<span class="k">print</span><span class="p">(</span><span class="n">clog</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">))</span>
<span class="k">print</span><span class="p">(</span><span class="n">clog</span><span class="o">.</span><span class="n">sub</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">))</span>
<span class="k">print</span><span class="p">(</span><span class="n">clog</span><span class="o">.</span><span class="n">mul</span><span class="p">(</span><span class="mi">4</span><span class="p">,</span> <span class="mi">5</span><span class="p">))</span>
<span class="k">print</span><span class="p">(</span><span class="n">clog</span><span class="o">.</span><span class="n">div</span><span class="p">(</span><span class="mi">5</span><span class="p">,</span> <span class="mi">6</span><span class="p">))</span>
</code></pre></div></div>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>INFO:root:Operation: Addition, Arguments: (1, 2)
INFO:root:Operation: Subtraction, Arguments: (2, 3)
INFO:root:Operation: Multiplication, Arguments: (4, 5)
INFO:root:Operation: Division, Arguments: (5, 6)


3
-1
20
0.8333333333333334
</code></pre></div></div>

<p>In the above class, I’ve defined another class called <code class="highlighter-rouge">CalcLog</code> that basically extends the functionalities of the previously defined <code class="highlighter-rouge">Calc</code> class. Here, I’ve inherited from the informal interface <code class="highlighter-rouge">ICalc</code> and implemented all the methods with additional info logging capability.</p>

<p>Although writing informal interfaces is trivial, there are multiple issues that plagues them. The user of the interface class can still instantiate it like a normal class and won’t be able to tell the difference between a it and a concrete class until she tries to use any of the methods define inside the interface. Only then the methods will throw exceptions. This can have unintended side effects.</p>

<p>Moreover, informal interfaces won’t compel you to implement all the methods in the subclasses. You can easily get away without implementing a particular method defined in the interface. It won’t complain about the unimplemented methods in the subclasses. However, if you try to use a method that hasn’t been implemented in the subclass, you’ll get an error. This means even if <code class="highlighter-rouge">issubclass(ConcreteSubClass, Interface)</code> shows <code class="highlighter-rouge">True</code>, you can’t rely on it since it doesn’t give you the guarantee that the <code class="highlighter-rouge">ConcreteSubClass</code> has implemented all the methods defined in the <code class="highlighter-rouge">Interface</code>.</p>

<p>Let’s create another class <code class="highlighter-rouge">FakeCalc</code> an only implement one method defined in the <code class="highlighter-rouge">ICalc</code> abstract class:</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">class</span> <span class="nc">FakeCalc</span><span class="p">(</span><span class="n">ICalc</span><span class="p">):</span>
    <span class="s">"""Concrete Class: Fake calculator that doesn't implement all the methods
    defined in the interface."""</span>

    <span class="k">def</span> <span class="nf">add</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">a</span> <span class="o">+</span> <span class="n">b</span>


<span class="c1"># Using the class
</span><span class="n">cfake</span> <span class="o">=</span> <span class="n">FakeCalc</span><span class="p">()</span>
<span class="k">print</span><span class="p">(</span><span class="n">cfake</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">))</span>
<span class="k">print</span><span class="p">(</span><span class="n">cfake</span><span class="o">.</span><span class="n">sub</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">))</span>
</code></pre></div></div>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>3

---------------------------------------------------------------------------

NotImplementedError                       Traceback (most recent call last)

&lt;ipython-input-48-035c519cee55&gt; in &lt;module&gt;
        10 cfake = FakeCalc()
        11 print(cfake.add(1,2))
---&gt; 12 print(cfake.sub(2,3))


&lt;ipython-input-45-255c6a2093b0&gt; in sub(self, a, b)
        6
        7     def sub(self, a, b):
----&gt; 8         raise NotImplementedError
        9
        10     def mul(self, a, b):


NotImplementedError:
</code></pre></div></div>

<p>Despite not implementing all the methods defined in the <code class="highlighter-rouge">ICalc</code> class, I was still able to instantiate the <code class="highlighter-rouge">FakeCalc</code> concrete class. However, when I tried to apply a method <code class="highlighter-rouge">sub</code> that wasn’t implemented in the concrete class, it gave me an error. Also, <code class="highlighter-rouge">issubclass(FakeCalc, ICalc)</code> returns <code class="highlighter-rouge">True</code> which can mislead you into thinking that all the methods of the subclass <code class="highlighter-rouge">FakeCalc</code> are usable. It can cause subtle bugs can be difficult to detect. Formal interfaces try to overcome these issues.</p>

<h2 id="formal-interfaces">
<a class="anchor" href="#formal-interfaces" aria-hidden="true"><span class="octicon octicon-link"></span></a>Formal Interfaces</h2>

<p>Formal interfaces do not suffer from the problems that plague informal interfaces. So if you want to implement an interface that the users can’t initiate independently and that forces them to implement all the methods in the concrete sub classes, formal interface is the way to go. In Python, the idiomatic way to define formal interfaces is via the <code class="highlighter-rouge">abc</code> module. Let’s transform the previously mentioned <code class="highlighter-rouge">ICalc</code> interface into a formal one:</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">from</span> <span class="nn">abc</span> <span class="kn">import</span> <span class="n">ABC</span><span class="p">,</span> <span class="n">abstractmethod</span>


<span class="k">class</span> <span class="nc">ICalc</span><span class="p">(</span><span class="n">ABC</span><span class="p">):</span>
    <span class="s">"""Formal interface: Abstract calculator class."""</span>

    <span class="o">@</span><span class="n">abstractmethod</span>
    <span class="k">def</span> <span class="nf">add</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">):</span>
        <span class="k">pass</span>

    <span class="o">@</span><span class="n">abstractmethod</span>
    <span class="k">def</span> <span class="nf">sub</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">):</span>
        <span class="k">pass</span>

    <span class="o">@</span><span class="n">abstractmethod</span>
    <span class="k">def</span> <span class="nf">mul</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">):</span>
        <span class="k">pass</span>

    <span class="o">@</span><span class="n">abstractmethod</span>
    <span class="k">def</span> <span class="nf">div</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">):</span>
        <span class="k">pass</span>
</code></pre></div></div>

<p>Here, I’ve imported <code class="highlighter-rouge">ABC</code> class and <code class="highlighter-rouge">abstractmethod</code> decorator from the <code class="highlighter-rouge">abc</code> module of Python’s standard library. The name <code class="highlighter-rouge">ABC</code> stands for <em>Abstract Base Class</em>. The interface class needs to inherit from this <code class="highlighter-rouge">ABC</code>class and all the abstract methods need to be decorated using the <code class="highlighter-rouge">abstractmethod</code> decorator. If your knowledge on decorators are fuzzy, checkout this in-depth article on <a href="https://rednafi.github.io/digressions/python/2020/05/13/python-decorators.html">python decorators</a>.</p>

<p>Although, it seems like <code class="highlighter-rouge">ICalc</code> has merely inherited from the <code class="highlighter-rouge">ABC</code> class, under the hood, a <a href="">metaclass</a> <code class="highlighter-rouge">ABCMeta</code> gets attached to the interface which essentially makes sure that you can’t instantiate this class independently. Let’s try to do so and see what happens:</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">i</span> <span class="o">=</span> <span class="n">ICalc</span><span class="p">()</span>
</code></pre></div></div>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>---------------------------------------------------------------------------
TypeError                                 Traceback (most recent call last)
&lt;ipython-input-118-a3cb2945d943&gt; in &lt;module&gt;
----&gt; 1 i = ICalc()

TypeError: Can't instantiate abstract class ICalc with abstract methods add, div, mul, sub
</code></pre></div></div>

<p>The error message clearly states that you can’t instantiate the class <code class="highlighter-rouge">ICalc</code> directly at all. You’ve make a subclass of <code class="highlighter-rouge">ICalc</code> and implement all the abstract methods and only then you’ll be able to make an instance of the subclass. The subclassing and implementation part is same as before.</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">class</span> <span class="nc">Calc</span><span class="p">(</span><span class="n">ICalc</span><span class="p">):</span>
    <span class="s">"""Concrete calculator class"""</span>

    <span class="k">def</span> <span class="nf">add</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">a</span> <span class="o">+</span> <span class="n">b</span>

    <span class="k">def</span> <span class="nf">sub</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">a</span> <span class="o">-</span> <span class="n">b</span>

    <span class="k">def</span> <span class="nf">mul</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">a</span> <span class="o">*</span> <span class="n">b</span>

    <span class="k">def</span> <span class="nf">div</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">a</span> <span class="o">/</span> <span class="n">b</span>


<span class="c1"># Using the class
</span><span class="n">c</span> <span class="o">=</span> <span class="n">Calc</span><span class="p">()</span>
<span class="k">print</span><span class="p">(</span><span class="n">c</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">))</span>
<span class="k">print</span><span class="p">(</span><span class="n">c</span><span class="o">.</span><span class="n">sub</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">))</span>
<span class="k">print</span><span class="p">(</span><span class="n">c</span><span class="o">.</span><span class="n">mul</span><span class="p">(</span><span class="mi">4</span><span class="p">,</span> <span class="mi">5</span><span class="p">))</span>
<span class="k">print</span><span class="p">(</span><span class="n">c</span><span class="o">.</span><span class="n">div</span><span class="p">(</span><span class="mi">5</span><span class="p">,</span> <span class="mi">6</span><span class="p">))</span>
</code></pre></div></div>

<p>In the case of formal interface, failing to implement even one abstract method in the subclass will raise <code class="highlighter-rouge">TypeError</code>. So you can never write something the like the <code class="highlighter-rouge">FakeCalc</code> with a formal interface. This approach is more explicit and if there is an issue, it fails early.</p>

<h3 id="interfaces-vs-abstract-base-classes">
<a class="anchor" href="#interfaces-vs-abstract-base-classes" aria-hidden="true"><span class="octicon octicon-link"></span></a>Interfaces vs Abstract Base Classes</h3>

<p>You’ve probably seen the term <em>Interface</em> and <em>Abstract Base Class</em> being used interchangeably. However, conceptually they’re different. Interfaces can be thought of as a special case of Abstract Base Classes.</p>

<p>It’s imperative that all the methods of an interface are abstract methods and the classes don’t store any state (instance variables). However, in case of abstract base classes, the methods are generally abstract but there can also be methods that provide implementation (concrete methods) and also, these classes can have instance variables. This generic abstract base classes can get very interesting and they can be used as <em>mixins</em> but more on that in the later sections.</p>

<p>Both interfaces and abstract base classes are similar in the sense that they can’t stand on their own, that means these classes aren’t meant to be instantiated independently. Pay attention to the following snippet to understand how interfaces and abstract base classes differ.</p>

<p><strong>Interface</strong></p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">from</span> <span class="nn">abc</span> <span class="kn">import</span> <span class="n">ABC</span><span class="p">,</span> <span class="n">abstractmethod</span>


<span class="k">class</span> <span class="nc">InterfaceExample</span><span class="p">(</span><span class="n">ABC</span><span class="p">):</span>
    <span class="o">@</span><span class="n">abstractmethod</span>
    <span class="k">def</span> <span class="nf">method_a</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">pass</span>

    <span class="o">@</span><span class="n">abstractmethod</span>
    <span class="k">def</span> <span class="nf">method_b</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">pass</span>
</code></pre></div></div>

<p>Here, all the methods must have to be abstract.</p>

<p><strong>Abstract Base Class</strong></p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">from</span> <span class="nn">abc</span> <span class="kn">import</span> <span class="n">ABC</span><span class="p">,</span> <span class="n">abstractmethod</span>


<span class="k">class</span> <span class="nc">AbstractBaseClassExample</span><span class="p">(</span><span class="n">ABC</span><span class="p">):</span>
    <span class="o">@</span><span class="n">abstractmethod</span>
    <span class="k">def</span> <span class="nf">method_a</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">pass</span>

    <span class="o">@</span><span class="n">abstractmethod</span>
    <span class="k">def</span> <span class="nf">method_b</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">pass</span>

    <span class="k">def</span> <span class="nf">method_c</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="c1"># implement something
</span>        <span class="k">pass</span>
</code></pre></div></div>

<p>Notice how <code class="highlighter-rouge">method_c</code> in the above class is a concrete method and can have implementation.</p>

<p>The two examples above establish the fact that</p>

<blockquote>
  <p>All interfaces are abstract base classes but not all abstract base classes are interfaces.</p>
</blockquote>

<h3 id="a-complete-example">
<a class="anchor" href="#a-complete-example" aria-hidden="true"><span class="octicon octicon-link"></span></a>A Complete Example</h3>

<p>Before moving on to the next section, let’s see another contrived example to get the idea about the cases where interfaces can come handy. I’ll define an interface called <code class="highlighter-rouge">AutoMobile</code> and create three concrete classes called <code class="highlighter-rouge">Car</code>, <code class="highlighter-rouge">Truck</code> and <code class="highlighter-rouge">Bus</code> from it. The interface defines three abstract methods <code class="highlighter-rouge">start</code>, <code class="highlighter-rouge">accelerate</code> and <code class="highlighter-rouge">stop</code> that the concrete classes will need to implement later.</p>

<p><img src="https://user-images.githubusercontent.com/30027932/86243108-96bbd680-bbc7-11ea-9ddb-9fe46b4a17a1.png" alt="python-interface"></p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">from</span> <span class="nn">abc</span> <span class="kn">import</span> <span class="n">ABC</span><span class="p">,</span> <span class="n">abstractmethod</span>


<span class="k">class</span> <span class="nc">Automobile</span><span class="p">(</span><span class="n">ABC</span><span class="p">):</span>
    <span class="s">"""Formal interface: Abstract automobile class."""</span>

    <span class="o">@</span><span class="n">abstractmethod</span>
    <span class="k">def</span> <span class="nf">start</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">pass</span>

    <span class="o">@</span><span class="n">abstractmethod</span>
    <span class="k">def</span> <span class="nf">accelerate</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">pass</span>

    <span class="o">@</span><span class="n">abstractmethod</span>
    <span class="k">def</span> <span class="nf">stop</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">pass</span>


<span class="k">class</span> <span class="nc">Car</span><span class="p">(</span><span class="n">Automobile</span><span class="p">):</span>
    <span class="s">"""Concrete Class: Car"""</span>

    <span class="k">def</span> <span class="nf">start</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="s">"The car is starting"</span>

    <span class="k">def</span> <span class="nf">accelerate</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="s">"The car is accelerating"</span>

    <span class="k">def</span> <span class="nf">stop</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="s">"The car is stopping"</span>


<span class="k">class</span> <span class="nc">Truck</span><span class="p">(</span><span class="n">Automobile</span><span class="p">):</span>
    <span class="s">"""Concrete Class: Truck"""</span>

    <span class="k">def</span> <span class="nf">start</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="s">"The truck is starting"</span>

    <span class="k">def</span> <span class="nf">accelerate</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="s">"The truck is accelerating"</span>

    <span class="k">def</span> <span class="nf">stop</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="s">"The truck is stopping"</span>


<span class="k">class</span> <span class="nc">Bus</span><span class="p">(</span><span class="n">Automobile</span><span class="p">):</span>
    <span class="s">"""Concrete Class: Bus"""</span>

    <span class="k">def</span> <span class="nf">start</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="s">"The bus is starting"</span>

    <span class="k">def</span> <span class="nf">accelerate</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="s">"The bus is accelerating"</span>

    <span class="k">def</span> <span class="nf">stop</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="s">"The bus is stopping"</span>


<span class="n">car</span> <span class="o">=</span> <span class="n">Car</span><span class="p">()</span>
<span class="n">truck</span> <span class="o">=</span> <span class="n">Truck</span><span class="p">()</span>
<span class="n">bus</span> <span class="o">=</span> <span class="n">Bus</span><span class="p">()</span>

<span class="k">print</span><span class="p">(</span><span class="n">car</span><span class="o">.</span><span class="n">start</span><span class="p">())</span>
<span class="k">print</span><span class="p">(</span><span class="n">car</span><span class="o">.</span><span class="n">accelerate</span><span class="p">())</span>
<span class="k">print</span><span class="p">(</span><span class="n">car</span><span class="o">.</span><span class="n">stop</span><span class="p">())</span>
<span class="k">print</span><span class="p">(</span><span class="n">truck</span><span class="o">.</span><span class="n">start</span><span class="p">())</span>
<span class="k">print</span><span class="p">(</span><span class="n">truck</span><span class="o">.</span><span class="n">accelerate</span><span class="p">())</span>
<span class="k">print</span><span class="p">(</span><span class="n">truck</span><span class="o">.</span><span class="n">stop</span><span class="p">())</span>
<span class="k">print</span><span class="p">(</span><span class="n">bus</span><span class="o">.</span><span class="n">start</span><span class="p">())</span>
<span class="k">print</span><span class="p">(</span><span class="n">bus</span><span class="o">.</span><span class="n">accelerate</span><span class="p">())</span>
<span class="k">print</span><span class="p">(</span><span class="n">bus</span><span class="o">.</span><span class="n">stop</span><span class="p">())</span>
</code></pre></div></div>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>The car is starting
The car is accelerating
The car is stopping
The truck is starting
The truck is accelerating
The truck is stopping
The bus is starting
The bus is accelerating
The bus is stopping
</code></pre></div></div>

<p>The above example delineates the use cases for interfaces. When you need to create multiple similar classes, interfaces can provide a basic foundation for the subclasses to build upon. In the next section, I’ll be using formal interfaces to create Mixin classes. So, before understanding mixin classes and how they can be used to inject additional plugins to your classes, it’s important that you understand interfaces and abstract base classes properly.</p>

<h2 id="mixins">
<a class="anchor" href="#mixins" aria-hidden="true"><span class="octicon octicon-link"></span></a>Mixins</h2>

<p>Imagine you’re baking chocolate brownies. Now, you can have them without any extra fluff which is fine or you can top them with cream cheese, caramel sauce, chocolate chips etc. Usually you don’t make the extra toppings yourself, rather you prepare the brownies and use off the shelf toppings. This also gives you the ability to mix and match different combinations of toppings to spruce up the flavors quickly. However, making the the toppings from scratch would be a lengthy process and doing it over an over again can ruin the fun of baking.</p>

<p>While creating software, there’s sometimes a limit to the depth we should go. When pieces of what we’d like to achieve have already been executed well by others, it makes a lot of sense to reuse them. One way to achieve modularity and reusability in object-oriented programming is through a concept called a mixin. Different languages implement the concept of mixin in different ways. In Python, mixins are supported via multiple inheritance.</p>

<h3 id="overview-1">
<a class="anchor" href="#overview-1" aria-hidden="true"><span class="octicon octicon-link"></span></a>Overview</h3>

<p>In the context of Python especially, a mixin is a parent class that provides functionality to subclasses but is not intended to be instantiated itself. This should already incite deja vu in you since <strong>classes that aren’t intended to be instantiated</strong> and can have both concrete and abstract methods are basically <strong>abstract base classes</strong>. Mixins can be regarded as a specific strain of abstract base classes where they can house both concrete and abstract methods but don’t keep any internal states.</p>

<p>These can help you when -</p>

<ul>
  <li>You want to provide a lot of optional features for a class.</li>
  <li>You want to provide a lot of not-optional features for a class, but you want the features in separate classes so that each of them is about one feature (behavior).</li>
  <li>You want to use one particular feature in many different classes</li>
</ul>

<p>Let’s see a contrived example. Consider an <a href="https://werkzeug.palletsprojects.com/en/1.0.x/">werkzeug’s</a> request and response system. Werkzeug is the low-level framework that <a href="https://flask.palletsprojects.com/en/1.1.x/">Flask</a> micro-framework is built upon. I can make a plain old request object by saying:</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">from</span> <span class="nn">werkzeug</span> <span class="kn">import</span> <span class="n">BaseRequest</span>


<span class="k">class</span> <span class="nc">Request</span><span class="p">(</span><span class="n">BaseRequest</span><span class="p">):</span>
    <span class="k">pass</span>
</code></pre></div></div>

<p>If I want to add accept header support, I would make that:</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">from</span> <span class="nn">werkzeug</span> <span class="kn">import</span> <span class="n">BaseRequest</span><span class="p">,</span> <span class="n">AcceptMixin</span>


<span class="k">class</span> <span class="nc">Request</span><span class="p">(</span><span class="n">AcceptMixin</span><span class="p">,</span> <span class="n">BaseRequest</span><span class="p">):</span>
    <span class="k">pass</span>
</code></pre></div></div>

<p>If I wanted to make a request object that supports accept headers, etags, user agent and authentication support, I could do this:</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">from</span> <span class="nn">werkzeug</span> <span class="kn">import</span> <span class="p">(</span>
    <span class="n">BaseRequest</span><span class="p">,</span>
    <span class="n">AcceptMixin</span><span class="p">,</span>
    <span class="n">ETagRequestMixin</span><span class="p">,</span>
    <span class="n">UserAgentMixin</span><span class="p">,</span>
    <span class="n">AuthenticationMixin</span><span class="p">,</span>
<span class="p">)</span>


<span class="k">class</span> <span class="nc">Request</span><span class="p">(</span>
    <span class="n">AcceptMixin</span><span class="p">,</span> <span class="n">ETagRequestMixin</span><span class="p">,</span> <span class="n">UserAgentMixin</span><span class="p">,</span> <span class="n">AuthenticationMixin</span><span class="p">,</span> <span class="n">BaseRequest</span>
<span class="p">):</span>
    <span class="k">pass</span>
</code></pre></div></div>

<p>The above example might cause you to say, “that’s just multiple inheritance, not really a mixin”, which is can be true in a special case. Indeed, the differences between plain old multiple inheritance and mixin based inheritance collapse when the parent class can be instantiated. Understanding the subtlety in the differences between a mixin class, an abstract base class, an interface and the scope of multiple inheritance is important, so I’ll explore them in a dedicated section.</p>

<h3 id="differences-between-interfaces-abstract-classes-and-mixins">
<a class="anchor" href="#differences-between-interfaces-abstract-classes-and-mixins" aria-hidden="true"><span class="octicon octicon-link"></span></a>Differences Between Interfaces, Abstract Classes and Mixins</h3>

<p>In order to better understand mixins, it’s be useful to compare mixins with abstract classes and interfaces from a code/implementation perspective:</p>

<p><strong>Interfaces</strong></p>

<p>Interfaces can contain abstract methods only, no concrete methods and no internal states (instance variables).</p>

<p><strong>Abstract Classes</strong></p>

<p>Abstract classes can contain abstract methods, concrete methods and internal state.</p>

<p><strong>Mixins</strong></p>

<p>Like interfaces, mixins do not contain any internal state. But like abstract classes, they can contain one or more concrete methods. <strong><em>So mixins are basically abstract classes without any internal states.</em></strong></p>

<p>In Python, these are just conventions because all of the above are defined as classes. However, one trait that is common among <em>interfaces</em>, <em>abstract classes</em> and <em>mixins</em> is that they shouldn’t exist on their own, i.e. shouldn’t be instantiated independently.</p>

<h3 id="a-complete-example-1">
<a class="anchor" href="#a-complete-example-1" aria-hidden="true"><span class="octicon octicon-link"></span></a>A Complete Example</h3>

<p>Before diving into the real-life examples and how mixins can be used to construct custom data structures, let’s have a look at a self-contained example of a mixin class at work:</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">import</span> <span class="nn">inspect</span>
<span class="kn">from</span> <span class="nn">abc</span> <span class="kn">import</span> <span class="n">ABC</span><span class="p">,</span> <span class="n">abstractmethod</span>
<span class="kn">from</span> <span class="nn">pprint</span> <span class="kn">import</span> <span class="n">pprint</span>


<span class="k">class</span> <span class="nc">DisplayFactorMult</span><span class="p">(</span><span class="n">ABC</span><span class="p">):</span>
    <span class="s">"""Mixin class that reveals factor calculation details."""</span>

    <span class="o">@</span><span class="n">abstractmethod</span>
    <span class="k">def</span> <span class="nf">multiply</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">):</span>
        <span class="k">pass</span>

    <span class="k">def</span> <span class="nf">multiply_show</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">):</span>
        <span class="n">result</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">multiply</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
        <span class="k">print</span><span class="p">(</span><span class="n">f</span><span class="s">"Factor: {self.factor}, Argument: {x},  Result: {result}"</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">result</span>


<span class="k">class</span> <span class="nc">FactorMult</span><span class="p">(</span><span class="n">DisplayFactorMult</span><span class="p">):</span>
    <span class="s">"""Concrete class that uses the DisplayFactorMult mixin."""</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">factor</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">factor</span> <span class="o">=</span> <span class="n">factor</span>

    <span class="k">def</span> <span class="nf">multiply</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">x</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">factor</span>


<span class="c1"># Putting the FactorMult class to use
</span><span class="n">f</span> <span class="o">=</span> <span class="n">FactorMult</span><span class="p">(</span><span class="mi">10</span><span class="p">)</span>
<span class="n">f</span><span class="o">.</span><span class="n">multiply_show</span><span class="p">(</span><span class="mi">20</span><span class="p">)</span>

<span class="c1"># Use the inspect.getmembers method to inspect the methods
</span><span class="n">pprint</span><span class="p">(</span><span class="n">inspect</span><span class="o">.</span><span class="n">getmembers</span><span class="p">(</span><span class="n">f</span><span class="p">,</span> <span class="n">predicate</span><span class="o">=</span><span class="n">inspect</span><span class="o">.</span><span class="n">ismethod</span><span class="p">))</span>
</code></pre></div></div>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>Factor: 10, Argument: 20,  Result: 200
[('__init__',
    &lt;bound method FactorMult.__init__ of &lt;__main__.FactorMult object at 0x7f0f0546bf40&gt;&gt;),
    ('multiply',
    &lt;bound method FactorMult.multiply of &lt;__main__.FactorMult object at 0x7f0f0546bf40&gt;&gt;),
    ('multiply_show',
    &lt;bound method DisplayFactorMult.multiply_show of &lt;__main__.FactorMult object at 0x7f0f0546bf40&gt;&gt;)]
</code></pre></div></div>

<p>The <code class="highlighter-rouge">FactorMult</code> class takes in a number as a factor and the <code class="highlighter-rouge">multiply</code> method simply multiplies an argument with the factor. The mixin class <code class="highlighter-rouge">DisplayFactorMult</code> provides an additional method <code class="highlighter-rouge">multiply_show</code> that enhances the <code class="highlighter-rouge">multiply</code> method of the concrete class. Method <code class="highlighter-rouge">multiply_show</code> prints the value of the factor, arguments an the result before returning the result. Here, <code class="highlighter-rouge">DisplayFactoryMult</code> is a mixin since it houses an abstract method <code class="highlighter-rouge">multiply</code>, a concrete method <code class="highlighter-rouge">multiply_show</code> and doesn’t store any instance variable.</p>

<p>If you really want to dive deeper into mixins and their real-life use cases, checkout the codebase of the famous <a href="https://github.com/psf/requests/blob/8149e9fe54c36951290f198e90d83c8a0498289c/requests/models.py#L60">Requests</a> library. It defines and employs many powerful mixin classes to bestow superpowers upon different concrete classes.</p>

<h2 id="building-powerful-custom-data-structures-with-mixins">
<a class="anchor" href="#building-powerful-custom-data-structures-with-mixins" aria-hidden="true"><span class="octicon octicon-link"></span></a>Building Powerful Custom Data Structures with Mixins</h2>

<p>You’ve reached the hall of fame where I’ll be building custom data structures using the mixin classes from the <code class="highlighter-rouge">collections.abc</code> module.</p>

<h3 id="verbose-tuple">
<a class="anchor" href="#verbose-tuple" aria-hidden="true"><span class="octicon octicon-link"></span></a>Verbose Tuple</h3>

<p>This is a tuple-like data structure that acts exactly like the built-in tuple but with one exception. It’ll print out the special methods underneath when you perform any operation with it.</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">from</span> <span class="nn">collections.abc</span> <span class="kn">import</span> <span class="n">Sequence</span>


<span class="k">class</span> <span class="nc">VerboseTuple</span><span class="p">(</span><span class="n">Sequence</span><span class="p">):</span>
    <span class="s">"""Custom class that is exactly like a tuple but does some
    extra magic.

    Sequence:
    -------------------
    Inherits From: Reversible, Collection
    Abstract Methods: __getitem__, __len__
    Mixin Methods: __contains__, __iter__, __reversed__, index,
            and count
    """</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">args</span> <span class="o">=</span> <span class="n">args</span>

    <span class="o">@</span><span class="nb">classmethod</span>
    <span class="k">def</span> <span class="nf">_classname</span><span class="p">(</span><span class="n">cls</span><span class="p">):</span>
        <span class="c1"># This method just returns the name of the class
</span>        <span class="k">return</span> <span class="n">cls</span><span class="o">.</span><span class="n">__name__</span>

    <span class="k">def</span> <span class="nf">__getitem__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">index</span><span class="p">):</span>
        <span class="k">print</span><span class="p">(</span><span class="n">f</span><span class="s">"Method: __getitem__, Index: {index}"</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">args</span><span class="p">[</span><span class="n">index</span><span class="p">]</span>

    <span class="k">def</span> <span class="nf">__len__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">print</span><span class="p">(</span><span class="n">f</span><span class="s">"Method: __len__"</span><span class="p">)</span>
        <span class="k">return</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">args</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">__repr__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">f</span><span class="s">"{self._classname()}{tuple(self.args)}"</span>


<span class="n">vt</span> <span class="o">=</span> <span class="n">VerboseTuple</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">)</span>

<span class="k">print</span><span class="p">(</span><span class="n">vt</span><span class="p">)</span>
<span class="k">print</span><span class="p">(</span><span class="n">f</span><span class="s">"Abstract Methods: {set(Sequence.__abstractmethods__)}"</span><span class="p">)</span>
<span class="k">print</span><span class="p">(</span><span class="n">f</span><span class="s">"Mixin Methods: { {k for k, v in Sequence.__dict__.items() if callable(v)} }"</span><span class="p">)</span>
</code></pre></div></div>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>VerboseTuple(1, 3, 4)
Abstract Methods: {'__len__', '__getitem__'}
Mixin Methods: {'__iter__', '__contains__', 'index', 'count', '__getitem__', '__reversed__'}
</code></pre></div></div>

<p>To build the <code class="highlighter-rouge">VerboseTuple</code> data structure, first, I’ve inherited the <code class="highlighter-rouge">Sequence</code> mixin class from the <code class="highlighter-rouge">collections.abc</code> module. The docstring mentions all the abstract and mixin methods provided by the <code class="highlighter-rouge">Sequence</code> class. To build the new data structure, you’ll have to implement all the abstract methods defined in the <code class="highlighter-rouge">Sequence</code> class and you’ll get all the mixin methods implemented automatically. Notice that the print statement above also reveals the abstract and the mixin methods.</p>

<p>In the following snippet I’ve used some of the functionalities offered by tuple and printed them in a way that will reveal the special methods when they perform any action.</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># check __getitem__
</span><span class="k">print</span><span class="p">(</span><span class="s">"</span><span class="se">\n</span><span class="s"> ==== Checking __getitem__ ===="</span><span class="p">)</span>
<span class="k">print</span><span class="p">(</span><span class="n">vt</span><span class="p">[</span><span class="mi">2</span><span class="p">])</span>

<span class="c1"># check __len__
</span><span class="k">print</span><span class="p">(</span><span class="s">"</span><span class="se">\n</span><span class="s"> ==== Checking __len__ ===="</span><span class="p">)</span>
<span class="k">print</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">vt</span><span class="p">))</span>

<span class="c1"># check __contains__
</span><span class="k">print</span><span class="p">(</span><span class="s">"</span><span class="se">\n</span><span class="s"> ==== Checking __contains__ ===="</span><span class="p">)</span>
<span class="k">print</span><span class="p">(</span><span class="mi">3</span> <span class="ow">in</span> <span class="n">vt</span><span class="p">)</span>

<span class="c1"># check __len__
</span><span class="k">print</span><span class="p">(</span><span class="s">"</span><span class="se">\n</span><span class="s"> ==== Checking __iter__ ===="</span><span class="p">)</span>
<span class="k">for</span> <span class="n">elem</span> <span class="ow">in</span> <span class="n">vt</span><span class="p">:</span>
    <span class="k">print</span><span class="p">(</span><span class="n">elem</span><span class="p">)</span>

<span class="c1"># check reverse
</span><span class="k">print</span><span class="p">(</span><span class="n">f</span><span class="s">"</span><span class="se">\n</span><span class="s"> ==== Checking reverse ===="</span><span class="p">)</span>
<span class="k">print</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="nb">reversed</span><span class="p">(</span><span class="n">vt</span><span class="p">)))</span>

<span class="c1"># check count
</span><span class="k">print</span><span class="p">(</span><span class="s">"</span><span class="se">\n</span><span class="s"> ==== Checking count ===="</span><span class="p">)</span>
<span class="k">print</span><span class="p">(</span><span class="n">vt</span><span class="o">.</span><span class="n">count</span><span class="p">(</span><span class="mi">1</span><span class="p">))</span>
</code></pre></div></div>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>    ==== Checking __getitem__ ====
Method: __getitem__, Index: 2
4

    ==== Checking __len__ ====
Method: __len__
3

    ==== Checking __contains__ ====
Method: __getitem__, Index: 0
Method: __getitem__, Index: 1
True

    ==== Checking __iter__ ====
Method: __getitem__, Index: 0
1
Method: __getitem__, Index: 1
3
Method: __getitem__, Index: 2
4
Method: __getitem__, Index: 3

    ==== Checking reverse ====
Method: __len__
Method: __getitem__, Index: 2
Method: __getitem__, Index: 1
Method: __getitem__, Index: 0
[4, 3, 1]

    ==== Checking count ====
Method: __getitem__, Index: 0
Method: __getitem__, Index: 1
Method: __getitem__, Index: 2
Method: __getitem__, Index: 3
1
</code></pre></div></div>

<p>The printed statements reveal the corresponding special methods used internally when a particular tuple operation occurs.</p>

<h3 id="verbose-list">
<a class="anchor" href="#verbose-list" aria-hidden="true"><span class="octicon octicon-link"></span></a>Verbose List</h3>

<p>This is a list-like data structure that acts exactly like the built-in list but with one exception. Like <code class="highlighter-rouge">VerboseTuple</code>, it’ll also print out the special methods underneath when you perform any operation on or with it.`</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">from</span> <span class="nn">collections.abc</span> <span class="kn">import</span> <span class="n">MutableSequence</span>


<span class="k">class</span> <span class="nc">VerboseList</span><span class="p">(</span><span class="n">MutableSequence</span><span class="p">):</span>
    <span class="s">"""Custom class that is exactly like a list but does some
    extra magic.

    MutableSequence:
    -----------------
    Inherits From: Sequence
    Abstract Methods: __getitem__, __setitem__, __delitem__,
            __len__, insert
    Mixin Methods: Inherited Sequence methods and append, reverse,
            extend, pop, remove, and __iadd__
    """</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">args</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">args</span><span class="p">)</span>

    <span class="o">@</span><span class="nb">classmethod</span>
    <span class="k">def</span> <span class="nf">_classname</span><span class="p">(</span><span class="n">cls</span><span class="p">):</span>
        <span class="c1"># This method just returns the name of the class
</span>        <span class="k">return</span> <span class="n">cls</span><span class="o">.</span><span class="n">__name__</span>

    <span class="k">def</span> <span class="nf">__getitem__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">index</span><span class="p">):</span>
        <span class="k">print</span><span class="p">(</span><span class="n">f</span><span class="s">"Method: __getitem__, Index: {index}"</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">args</span><span class="p">[</span><span class="n">index</span><span class="p">]</span>

    <span class="k">def</span> <span class="nf">__setitem__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">index</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
        <span class="k">print</span><span class="p">(</span><span class="n">f</span><span class="s">"Method: __setitem__, Index: {index}, Value: {value}"</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">args</span><span class="p">[</span><span class="n">index</span><span class="p">]</span> <span class="o">=</span> <span class="n">value</span>

    <span class="k">def</span> <span class="nf">__delitem__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">index</span><span class="p">):</span>
        <span class="k">print</span><span class="p">(</span><span class="n">f</span><span class="s">"Method: __delitem__, Index: {index}"</span><span class="p">)</span>
        <span class="k">del</span> <span class="bp">self</span><span class="o">.</span><span class="n">args</span><span class="p">[</span><span class="n">index</span><span class="p">]</span>

    <span class="k">def</span> <span class="nf">__len__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">print</span><span class="p">(</span><span class="n">f</span><span class="s">"Method: __len__"</span><span class="p">)</span>
        <span class="k">return</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">args</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">__repr__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">f</span><span class="s">"{self._classname()}{tuple(self.args)}"</span>

    <span class="k">def</span> <span class="nf">insert</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">index</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">args</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span><span class="n">index</span><span class="p">,</span> <span class="n">value</span><span class="p">)</span>


<span class="n">vl</span> <span class="o">=</span> <span class="n">VerboseList</span><span class="p">(</span><span class="mi">4</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">6</span><span class="p">)</span>
<span class="n">vl2</span> <span class="o">=</span> <span class="n">VerboseList</span><span class="p">(</span><span class="mi">7</span><span class="p">,</span> <span class="mi">8</span><span class="p">,</span> <span class="mi">9</span><span class="p">)</span>

<span class="k">print</span><span class="p">(</span><span class="n">vl</span><span class="p">)</span>
<span class="k">print</span><span class="p">(</span><span class="n">f</span><span class="s">"Abstract Methods: {set(MutableSequence.__abstractmethods__)}"</span><span class="p">)</span>
<span class="k">print</span><span class="p">(</span>
    <span class="n">f</span><span class="s">"Mixin Methods: { {k for k, v in MutableSequence.__dict__.items() if callable(v)} }"</span>
<span class="p">)</span>
</code></pre></div></div>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>VerboseList(4, 5, 6)
Abstract Methods: {'__delitem__', '__len__', '__getitem__', 'insert', '__setitem__'}
Mixin Methods: {'__iadd__', '__setitem__', 'pop', 'append', 'extend', '__delitem__', 'reverse', 'insert', 'clear', 'remove'}
</code></pre></div></div>

<p>In the above segment, I’ve inherited the <code class="highlighter-rouge">MutableSequence</code> mixin class from the <code class="highlighter-rouge">collections.abc</code> module. This ensures that the <code class="highlighter-rouge">VerboseList</code> object will be mutable. All the abstract methods mentioned in the docstring have been implemented and the output print statements reveal the structure of the custom data structure as well as all the abstract and mixin methods.</p>

<p>In the following snippet, I’ve used some of the functionalities offered by list and printed them in a way that will reveal the special methods when they perform any action.</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># check __setitem__
</span><span class="k">print</span><span class="p">(</span><span class="s">"</span><span class="se">\n</span><span class="s"> ==== Checking __setitem__ ===="</span><span class="p">)</span>
<span class="n">vl</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="mi">44</span>
<span class="k">print</span><span class="p">(</span><span class="n">vl</span><span class="p">)</span>

<span class="c1"># check remove (__delitem__)
</span><span class="k">print</span><span class="p">(</span><span class="s">"</span><span class="se">\n</span><span class="s"> ==== Checking remove ===="</span><span class="p">)</span>
<span class="n">vl</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="mi">6</span><span class="p">)</span>
<span class="k">print</span><span class="p">(</span><span class="n">vl</span><span class="p">)</span>

<span class="c1"># check extend
</span><span class="k">print</span><span class="p">(</span><span class="s">"</span><span class="se">\n</span><span class="s"> ==== Checking extend ===="</span><span class="p">)</span>
<span class="n">vl</span><span class="o">.</span><span class="n">extend</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">])</span>
<span class="k">print</span><span class="p">(</span><span class="n">vl</span><span class="p">)</span>

<span class="c1"># check pop
</span><span class="k">print</span><span class="p">(</span><span class="s">"</span><span class="se">\n</span><span class="s"> ==== Checking pop ===="</span><span class="p">)</span>
<span class="n">vl</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span>
<span class="k">print</span><span class="p">(</span><span class="n">vl</span><span class="p">)</span>

<span class="c1"># check __iadd__
</span><span class="k">print</span><span class="p">(</span><span class="s">"</span><span class="se">\n</span><span class="s"> ==== Checking __iadd__"</span><span class="p">)</span>
<span class="n">vl</span> <span class="o">+=</span> <span class="n">vl2</span>
<span class="k">print</span><span class="p">(</span><span class="n">vl</span><span class="p">)</span>
</code></pre></div></div>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>    ==== Checking __setitem__ ====
Method: __setitem__, Index: 1, Value: 44
VerboseList(4, 44, 6)

    ==== Checking remove ====
Method: __getitem__, Index: 0
Method: __getitem__, Index: 1
Method: __getitem__, Index: 2
Method: __delitem__, Index: 2
VerboseList(4, 44)

    ==== Checking extend ====
Method: __len__
Method: __len__
VerboseList(4, 44, 0, 0)

    ==== Checking pop ====
Method: __getitem__, Index: -1
Method: __delitem__, Index: -1
VerboseList(4, 44, 0)

    ==== Checking __iadd__
Method: __getitem__, Index: 0
Method: __len__
Method: __getitem__, Index: 1
Method: __len__
Method: __getitem__, Index: 2
Method: __len__
Method: __getitem__, Index: 3
VerboseList(4, 44, 0, 7, 8, 9)
</code></pre></div></div>

<h3 id="verbose-frozen-dict">
<a class="anchor" href="#verbose-frozen-dict" aria-hidden="true"><span class="octicon octicon-link"></span></a>Verbose Frozen Dict</h3>

<p>Here, <code class="highlighter-rouge">VerboseFrozenDict</code> is an immutable data structure that is similar to the built-in dictionaries. Like the previous structures, this also reveals the internal special methods while performing different operations.</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">from</span> <span class="nn">collections.abc</span> <span class="kn">import</span> <span class="n">Mapping</span>


<span class="k">class</span> <span class="nc">VerboseFrozenDict</span><span class="p">(</span><span class="n">Mapping</span><span class="p">):</span>
    <span class="s">"""Custom class that is exactly like an immutable dict but does
    some extra magic.

    Mapping:
    -----------------
    Inherits From: Collection
    Abstract Methods: __getitem__, __iter__, __len__
    Mixin Methods: __contains__, keys, items, values, get, __eq__,
            and __ne__
    """</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span> <span class="o">=</span> <span class="n">kwargs</span>

    <span class="o">@</span><span class="nb">classmethod</span>
    <span class="k">def</span> <span class="nf">_classname</span><span class="p">(</span><span class="n">cls</span><span class="p">):</span>
        <span class="c1"># This method just returns the name of the class
</span>        <span class="k">return</span> <span class="n">cls</span><span class="o">.</span><span class="n">__name__</span>

    <span class="k">def</span> <span class="nf">__getitem__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">key</span><span class="p">):</span>
        <span class="k">print</span><span class="p">(</span><span class="n">f</span><span class="s">"Method: __getitem__, Key: {key}"</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="p">[</span><span class="n">key</span><span class="p">]</span>

    <span class="k">def</span> <span class="nf">__iter__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">print</span><span class="p">(</span><span class="n">f</span><span class="s">"Method: __iter__"</span><span class="p">)</span>
        <span class="k">return</span> <span class="nb">iter</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">__len__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">print</span><span class="p">(</span><span class="n">f</span><span class="s">"Method: __len__"</span><span class="p">)</span>
        <span class="k">return</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">__repr__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">f</span><span class="s">"{self._classname()}({self.kwargs})"</span>


<span class="n">vf</span> <span class="o">=</span> <span class="n">VerboseFrozenDict</span><span class="p">(</span><span class="o">**</span><span class="p">{</span><span class="s">"a"</span><span class="p">:</span> <span class="s">"apple"</span><span class="p">})</span>
<span class="n">vf2</span> <span class="o">=</span> <span class="n">VerboseFrozenDict</span><span class="p">(</span><span class="o">**</span><span class="p">{</span><span class="s">"b"</span><span class="p">:</span> <span class="s">"orange"</span><span class="p">,</span> <span class="s">"c"</span><span class="p">:</span> <span class="s">"mango"</span><span class="p">})</span>

<span class="k">print</span><span class="p">(</span><span class="n">vf</span><span class="p">)</span>
<span class="k">print</span><span class="p">(</span><span class="n">f</span><span class="s">"Abstract Methods: {set(Mapping.__abstractmethods__)}"</span><span class="p">)</span>
<span class="k">print</span><span class="p">(</span><span class="n">f</span><span class="s">"Mixin Methods: { {k for k, v in Mapping.__dict__.items() if callable(v)} }"</span><span class="p">)</span>
</code></pre></div></div>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>VerboseFrozenDict({'a': 'apple'})
Abstract Methods: {'__len__', '__getitem__', '__iter__'}
Mixin Methods: {'items', '__contains__', 'values', '__eq__', 'keys', 'get', '__getitem__'}
</code></pre></div></div>

<p>In the above segment, I’ve inherited the <code class="highlighter-rouge">Mapping</code> mixin class from the <code class="highlighter-rouge">collections.abc</code> module. This ensures that the output sequence will be immutable. Just like before, all the abstract methods mentioned in the docstring have been implemented and the output print statements reveal the structure of the custom data structure, all the abstract and mixin methods.</p>

<p>Below the printed output will reveal the special methods used internally when the <code class="highlighter-rouge">VerboseFrozenDict</code> objects perform any operation.</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># check __getitem__
</span><span class="k">print</span><span class="p">(</span><span class="s">"</span><span class="se">\n</span><span class="s"> ==== Checking __getitem__ ===="</span><span class="p">)</span>
<span class="k">print</span><span class="p">(</span><span class="n">vf</span><span class="p">[</span><span class="s">"a"</span><span class="p">])</span>

<span class="c1"># check __iter__
</span><span class="k">print</span><span class="p">(</span><span class="s">"</span><span class="se">\n</span><span class="s"> ==== Checking __iter__ ===="</span><span class="p">)</span>
<span class="k">for</span> <span class="n">elem</span> <span class="ow">in</span> <span class="n">vf</span><span class="p">:</span>
    <span class="k">print</span><span class="p">(</span><span class="n">elem</span><span class="p">)</span>

<span class="c1"># check __len__
</span><span class="k">print</span><span class="p">(</span><span class="s">"</span><span class="se">\n</span><span class="s"> ==== Checking __len__ ===="</span><span class="p">)</span>
<span class="k">print</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">vf</span><span class="p">))</span>

<span class="c1"># check __contains__
</span><span class="k">print</span><span class="p">(</span><span class="s">"</span><span class="se">\n</span><span class="s"> ==== Checking __iter__ ===="</span><span class="p">)</span>
<span class="k">print</span><span class="p">(</span><span class="s">"a"</span> <span class="ow">in</span> <span class="n">vf</span><span class="p">)</span>

<span class="c1"># check keys, values
</span><span class="k">print</span><span class="p">(</span><span class="n">f</span><span class="s">"</span><span class="se">\n</span><span class="s"> ==== Checking items, keys, values ===="</span><span class="p">)</span>
<span class="k">print</span><span class="p">(</span><span class="n">vf</span><span class="o">.</span><span class="n">items</span><span class="p">())</span>
<span class="k">print</span><span class="p">(</span><span class="n">vf</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span>
<span class="k">print</span><span class="p">(</span><span class="n">vf</span><span class="o">.</span><span class="n">values</span><span class="p">())</span>

<span class="c1"># check get
</span><span class="k">print</span><span class="p">(</span><span class="s">"</span><span class="se">\n</span><span class="s"> ==== Checking get ===="</span><span class="p">)</span>
<span class="k">print</span><span class="p">(</span><span class="n">vf</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">"b"</span><span class="p">,</span> <span class="bp">None</span><span class="p">))</span>

<span class="c1"># check eq &amp; nq
</span><span class="k">print</span><span class="p">(</span><span class="s">"</span><span class="se">\n</span><span class="s"> ==== Checking __eq__, __nq__ ===="</span><span class="p">)</span>
<span class="k">print</span><span class="p">(</span><span class="n">vf</span> <span class="o">==</span> <span class="n">vf2</span><span class="p">)</span>
<span class="k">print</span><span class="p">(</span><span class="n">vf</span> <span class="o">!=</span> <span class="n">vf2</span><span class="p">)</span>
</code></pre></div></div>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>    ==== Checking __getitem__ ====
Method: __getitem__, Key: a
apple

    ==== Checking __iter__ ====
Method: __iter__
a

    ==== Checking __len__ ====
Method: __len__
1

    ==== Checking __iter__ ====
Method: __getitem__, Key: a
True

    ==== Checking items, keys, values ====
ItemsView(VerboseFrozenDict({'a': 'apple'}))
KeysView(VerboseFrozenDict({'a': 'apple'}))
ValuesView(VerboseFrozenDict({'a': 'apple'}))

    ==== Checking get ====
Method: __getitem__, Key: b
None

    ==== Checking __eq__, __nq__ ====
Method: __iter__
Method: __getitem__, Key: a
Method: __iter__
Method: __getitem__, Key: b
Method: __getitem__, Key: c
False
Method: __iter__
Method: __getitem__, Key: a
Method: __iter__
Method: __getitem__, Key: b
Method: __getitem__, Key: c
True
</code></pre></div></div>

<h3 id="verbose-dict">
<a class="anchor" href="#verbose-dict" aria-hidden="true"><span class="octicon octicon-link"></span></a>Verbose Dict</h3>

<p>The <code class="highlighter-rouge">VerboseDict</code> data structure is the mutable version of <code class="highlighter-rouge">VerboseFrozedDict</code>. It supports all the operations of <code class="highlighter-rouge">VerboseFrozenDict</code> with some additional features like adding and deleting key-value pairs, updating values corresponding to different keys etc.</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">from</span> <span class="nn">collections.abc</span> <span class="kn">import</span> <span class="n">MutableMapping</span>


<span class="k">class</span> <span class="nc">VerboseDict</span><span class="p">(</span><span class="n">MutableMapping</span><span class="p">):</span>
    <span class="s">"""Custom class that is exactly like a dict but does some
    extra magic.

    MutableMapping:
    -----------------
    Inherits From: Mapping
    Abstract Methods: __getitem__, __setitem__, __delitem__, __iter__,
                __len__
    Mixin Methods: Inherited Mapping methods and pop, popitem, clear,
                update, and setdefault
    """</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span> <span class="o">=</span> <span class="n">kwargs</span>

    <span class="o">@</span><span class="nb">classmethod</span>
    <span class="k">def</span> <span class="nf">_classname</span><span class="p">(</span><span class="n">cls</span><span class="p">):</span>
        <span class="c1"># This method just returns the name of the class
</span>        <span class="k">return</span> <span class="n">cls</span><span class="o">.</span><span class="n">__name__</span>

    <span class="k">def</span> <span class="nf">__getitem__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">key</span><span class="p">):</span>
        <span class="k">print</span><span class="p">(</span><span class="n">f</span><span class="s">"Method: __getitem__, Key: {key}"</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="p">[</span><span class="n">key</span><span class="p">]</span>

    <span class="k">def</span> <span class="nf">__setitem__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">key</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
        <span class="k">print</span><span class="p">(</span><span class="n">f</span><span class="s">"Method: __setitem__, Key: {key}"</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="n">value</span>

    <span class="k">def</span> <span class="nf">__delitem__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">key</span><span class="p">):</span>
        <span class="k">print</span><span class="p">(</span><span class="n">f</span><span class="s">"Method: __delitem__, Key: {key}"</span><span class="p">)</span>
        <span class="k">del</span> <span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="p">[</span><span class="n">key</span><span class="p">]</span>

    <span class="k">def</span> <span class="nf">__iter__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">print</span><span class="p">(</span><span class="n">f</span><span class="s">"Method: __iter__"</span><span class="p">)</span>
        <span class="k">return</span> <span class="nb">iter</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">__len__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">print</span><span class="p">(</span><span class="n">f</span><span class="s">"Method: __len__"</span><span class="p">)</span>
        <span class="k">return</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">__repr__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">f</span><span class="s">"{self._classname()}({self.kwargs})"</span>


<span class="n">vd</span> <span class="o">=</span> <span class="n">VerboseDict</span><span class="p">(</span><span class="o">**</span><span class="p">{</span><span class="s">"a"</span><span class="p">:</span> <span class="s">"apple"</span><span class="p">,</span> <span class="s">"b"</span><span class="p">:</span> <span class="s">"ball"</span><span class="p">,</span> <span class="s">"c"</span><span class="p">:</span> <span class="s">"cat"</span><span class="p">})</span>

<span class="k">print</span><span class="p">(</span><span class="n">vd</span><span class="p">)</span>
<span class="k">print</span><span class="p">(</span><span class="n">f</span><span class="s">"Abstract Methods: {set(MutableMapping.__abstractmethods__)}"</span><span class="p">)</span>
<span class="k">print</span><span class="p">(</span>
    <span class="n">f</span><span class="s">"Mixin Methods: { {k for k, v in MutableMapping.__dict__.items() if callable(v)} }"</span>
<span class="p">)</span>
</code></pre></div></div>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>VerboseDict({'a': 'apple', 'b': 'ball', 'c': 'cat'})
Abstract Methods: {'__delitem__', '__len__', '__iter__', '__getitem__', '__setitem__'}
Mixin Methods: {'__setitem__', 'pop', 'popitem', '__delitem__', 'setdefault', 'update', 'clear'}
</code></pre></div></div>

<p>The output statements reveal the structure of the <code class="highlighter-rouge">VeboseDict</code> class and the abstract and mixin methods associated with it. The following snippet will print the special methods used internally by the custom data structure (also in the built-in one) while performing different operations.</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># check __getitem__
</span><span class="k">print</span><span class="p">(</span><span class="s">"</span><span class="se">\n</span><span class="s"> ==== Checking __setitem__ ===="</span><span class="p">)</span>
<span class="n">vd</span><span class="p">[</span><span class="s">"a"</span><span class="p">]</span> <span class="o">=</span> <span class="s">"orange"</span>
<span class="k">print</span><span class="p">(</span><span class="n">vd</span><span class="p">)</span>

<span class="c1"># check popitem
</span><span class="k">print</span><span class="p">(</span><span class="s">"</span><span class="se">\n</span><span class="s"> ==== Checking popitem ===="</span><span class="p">)</span>
<span class="n">vd</span><span class="o">.</span><span class="n">popitem</span><span class="p">()</span>
<span class="k">print</span><span class="p">(</span><span class="n">vd</span><span class="p">)</span>

<span class="c1"># check update
</span><span class="k">print</span><span class="p">(</span><span class="s">"</span><span class="se">\n</span><span class="s"> ==== Checking update ===="</span><span class="p">)</span>
<span class="n">vd</span><span class="o">.</span><span class="n">update</span><span class="p">({</span><span class="s">"d"</span><span class="p">:</span> <span class="s">"dog"</span><span class="p">})</span>
<span class="k">print</span><span class="p">(</span><span class="n">vd</span><span class="p">)</span>

<span class="c1"># check clear
</span><span class="k">print</span><span class="p">(</span><span class="s">"</span><span class="se">\n</span><span class="s"> ==== Checking clear ===="</span><span class="p">)</span>
<span class="n">vd</span><span class="o">.</span><span class="n">clear</span><span class="p">()</span>
<span class="k">print</span><span class="p">(</span><span class="n">vd</span><span class="p">)</span>

<span class="c1"># check setdefault
</span><span class="k">print</span><span class="p">(</span><span class="n">f</span><span class="s">"</span><span class="se">\n</span><span class="s"> ==== Checking setdefault ===="</span><span class="p">)</span>
<span class="n">x</span> <span class="o">=</span> <span class="n">vd</span><span class="o">.</span><span class="n">setdefault</span><span class="p">(</span><span class="s">"a"</span><span class="p">,</span> <span class="s">"pepsi"</span><span class="p">)</span>
<span class="k">print</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
<span class="k">print</span><span class="p">(</span><span class="n">vd</span><span class="p">)</span>
</code></pre></div></div>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>    ==== Checking __setitem__ ====
Method: __setitem__, Key: a
VerboseDict({'a': 'orange', 'b': 'ball', 'c': 'cat'})

    ==== Checking popitem ====
Method: __iter__
Method: __getitem__, Key: a
Method: __delitem__, Key: a
VerboseDict({'b': 'ball', 'c': 'cat'})

    ==== Checking update ====
Method: __setitem__, Key: d
VerboseDict({'b': 'ball', 'c': 'cat', 'd': 'dog'})

    ==== Checking clear ====
Method: __iter__
Method: __getitem__, Key: b
Method: __delitem__, Key: b
Method: __iter__
Method: __getitem__, Key: c
Method: __delitem__, Key: c
Method: __iter__
Method: __getitem__, Key: d
Method: __delitem__, Key: d
Method: __iter__
VerboseDict({})

    ==== Checking setdefault ====
Method: __getitem__, Key: a
Method: __setitem__, Key: a
pepsi
VerboseDict({'a': 'pepsi'})
</code></pre></div></div>

<h2 id="going-ballistic-with-custom-data-structures">
<a class="anchor" href="#going-ballistic-with-custom-data-structures" aria-hidden="true"><span class="octicon octicon-link"></span></a>Going Ballistic with Custom Data Structures</h2>

<p>This section discusses two advanced data structures that I mentioned at the beginning of the post.</p>

<ul>
  <li>
    <p>BitSet : Mutable set-like data structure that doesn’t perform hashing</p>
  </li>
  <li>
    <p>SQLAlchemyDict: Mutable dict-like data structure that can store key-value pairs in any SQLAlchemy supported relational database</p>
  </li>
</ul>

<h3 id="bitset">
<a class="anchor" href="#bitset" aria-hidden="true"><span class="octicon octicon-link"></span></a>BitSet</h3>

<p>This mutable set-like data structure doesn’t perform hashing to store data. It can store integers in a fixed range. While storing integers, <code class="highlighter-rouge">BitSet</code> objects use less memory compared to built-in sets.</p>

<p>However, since no hashing happens, it’s slower to perform addition and retrieval compared to built-in sets. The following code snippet was taken directly from <a href="https://twitter.com/raymondh">Raymond Hettinger</a>’s 2019 PyCon Russia <a href="https://www.youtube.com/watch?v=S_ipdVNSFlo">talk</a> on advanced data structures.</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">from</span> <span class="nn">collections.abc</span> <span class="kn">import</span> <span class="n">MutableSet</span>


<span class="k">class</span> <span class="nc">BitSet</span><span class="p">(</span><span class="n">MutableSet</span><span class="p">):</span>
    <span class="s">"Ordered set with compact storage for integers in a fixed range"</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">limit</span><span class="p">,</span> <span class="n">iterable</span><span class="o">=</span><span class="p">()):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">limit</span> <span class="o">=</span> <span class="n">limit</span>
        <span class="n">num_bytes</span> <span class="o">=</span> <span class="p">(</span><span class="n">limit</span> <span class="o">+</span> <span class="mi">7</span><span class="p">)</span> <span class="o">//</span> <span class="mi">8</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">data</span> <span class="o">=</span> <span class="nb">bytearray</span><span class="p">(</span><span class="n">num_bytes</span><span class="p">)</span>
        <span class="bp">self</span> <span class="o">|=</span> <span class="n">iterable</span>

    <span class="k">def</span> <span class="nf">_get_location</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">elem</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">elem</span> <span class="o">&lt;</span> <span class="mi">0</span> <span class="ow">or</span> <span class="n">elem</span> <span class="o">&gt;=</span> <span class="bp">self</span><span class="o">.</span><span class="n">limit</span><span class="p">:</span>
            <span class="k">raise</span> <span class="nb">ValueError</span><span class="p">(</span><span class="n">f</span><span class="s">"{elem!r} must be in range 0 &lt;= elem &lt; {self.limit}"</span><span class="p">)</span>
        <span class="k">return</span> <span class="nb">divmod</span><span class="p">(</span><span class="n">elem</span><span class="p">,</span> <span class="mi">8</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">__contains__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">elem</span><span class="p">):</span>
        <span class="n">bytenum</span><span class="p">,</span> <span class="n">bitnum</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_location</span><span class="p">(</span><span class="n">elem</span><span class="p">)</span>
        <span class="k">return</span> <span class="nb">bool</span><span class="p">((</span><span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="n">bytenum</span><span class="p">]</span> <span class="o">&gt;&gt;</span> <span class="n">bitnum</span><span class="p">)</span> <span class="o">&amp;</span> <span class="mi">1</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">add</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">elem</span><span class="p">):</span>
        <span class="n">bytenum</span><span class="p">,</span> <span class="n">bitnum</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_location</span><span class="p">(</span><span class="n">elem</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="n">bytenum</span><span class="p">]</span> <span class="o">|=</span> <span class="mi">1</span> <span class="o">&lt;&lt;</span> <span class="n">bitnum</span>

    <span class="k">def</span> <span class="nf">discard</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">elem</span><span class="p">):</span>
        <span class="n">bytenum</span><span class="p">,</span> <span class="n">bitnum</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_location</span><span class="p">(</span><span class="n">elem</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="n">bytenum</span><span class="p">]</span> <span class="o">&amp;=</span> <span class="o">~</span><span class="p">(</span><span class="mi">1</span> <span class="o">&lt;&lt;</span> <span class="n">bitnum</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">__iter__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">for</span> <span class="n">elem</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">limit</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">elem</span> <span class="ow">in</span> <span class="bp">self</span><span class="p">:</span>
                <span class="k">yield</span> <span class="n">elem</span>

    <span class="k">def</span> <span class="nf">__len__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="nb">sum</span><span class="p">(</span><span class="mi">1</span> <span class="k">for</span> <span class="n">elem</span> <span class="ow">in</span> <span class="bp">self</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">__repr__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">f</span><span class="s">"{type(self).__name__}(limit={self.limit}, iterable={list(self)})"</span>

    <span class="k">def</span> <span class="nf">_from_iterable</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">iterable</span><span class="p">):</span>
        <span class="k">return</span> <span class="nb">type</span><span class="p">(</span><span class="bp">self</span><span class="p">)(</span><span class="bp">self</span><span class="o">.</span><span class="n">limit</span><span class="p">,</span> <span class="n">iterable</span><span class="p">)</span>
</code></pre></div></div>

<p>Let’s inspect the above data structure to understand exactly how much memory we can save. I’ll digress a little here. Normally, you’d use <code class="highlighter-rouge">sys.getsizeof</code> to measure the memory footprint of an object where the function reveals the size in bytes.</p>

<p>But there’s a problem. The function <code class="highlighter-rouge">sys.getsizeof</code> only reveals the size of the target object, excluding the objects the target objects might be referring to. To understand what I mean, consider the following situation:</p>

<p>Suppose, you have a nested list that looks like this:</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">lst</span> <span class="o">=</span> <span class="p">[[</span><span class="mi">1</span><span class="p">],</span> <span class="p">[</span><span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">],</span> <span class="p">[[</span><span class="mi">4</span><span class="p">,</span> <span class="mi">5</span><span class="p">],</span> <span class="mi">6</span><span class="p">,</span> <span class="mi">7</span><span class="p">],</span> <span class="mi">8</span><span class="p">,</span> <span class="mi">9</span><span class="p">]</span>
</code></pre></div></div>

<p>When you apply <code class="highlighter-rouge">sys.getsizeof</code> function on the list, it shows 96 bytes. This means only the outermost list consumes 96 bytes of memory. Here, <code class="highlighter-rouge">sys.getsizeof</code> doesn’t include the size of the nested lists.</p>

<p>The same is true for other data structures. In case of nested dictionaries, <code class="highlighter-rouge">sys.getsizeof</code> will not include the size of nested data structures. I’ll only reveal the size of the outermost dictionary object. The following snippet will traverse through the reference tree of a nested object and reveal the <em>true</em> size of it.</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">from</span> <span class="nn">collections.abc</span> <span class="kn">import</span> <span class="n">Mapping</span><span class="p">,</span> <span class="n">Container</span>
<span class="kn">from</span> <span class="nn">sys</span> <span class="kn">import</span> <span class="n">getsizeof</span>


<span class="k">def</span> <span class="nf">deep_getsizeof</span><span class="p">(</span><span class="n">o</span><span class="p">:</span> <span class="nb">object</span><span class="p">,</span> <span class="n">ids</span><span class="p">:</span> <span class="bp">None</span> <span class="o">=</span> <span class="bp">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">int</span><span class="p">:</span>
    <span class="s">"""Find the memory footprint of a Python object.

    This is a recursive function that drills down a Python object graph
    like a dictionary holding nested dictionaries with lists of lists
    and tuples and sets.

    The sys.getsizeof function does a shallow size of only. It counts each
    object inside a container as pointer only regardless of how big it
    really is.

    Params
    ------
     o: object
        The object
     ids: None
        Later an iterable is assigned to store the object ids

     Returns
     --------
     int
        Returns the size of object in bytes
    """</span>

    <span class="k">if</span> <span class="n">ids</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
        <span class="n">ids</span> <span class="o">=</span> <span class="nb">set</span><span class="p">()</span>

    <span class="n">d</span> <span class="o">=</span> <span class="n">deep_getsizeof</span>
    <span class="k">if</span> <span class="nb">id</span><span class="p">(</span><span class="n">o</span><span class="p">)</span> <span class="ow">in</span> <span class="n">ids</span><span class="p">:</span>
        <span class="k">return</span> <span class="mi">0</span>

    <span class="n">r</span> <span class="o">=</span> <span class="n">getsizeof</span><span class="p">(</span><span class="n">o</span><span class="p">)</span>
    <span class="n">ids</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="nb">id</span><span class="p">(</span><span class="n">o</span><span class="p">))</span>

    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">o</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">r</span>

    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">o</span><span class="p">,</span> <span class="n">Mapping</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">r</span> <span class="o">+</span> <span class="nb">sum</span><span class="p">(</span><span class="n">d</span><span class="p">(</span><span class="n">k</span><span class="p">,</span> <span class="n">ids</span><span class="p">)</span> <span class="o">+</span> <span class="n">d</span><span class="p">(</span><span class="n">v</span><span class="p">,</span> <span class="n">ids</span><span class="p">)</span> <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">o</span><span class="o">.</span><span class="n">iteritems</span><span class="p">())</span>

    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">o</span><span class="p">,</span> <span class="n">Container</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">r</span> <span class="o">+</span> <span class="nb">sum</span><span class="p">(</span><span class="n">d</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">ids</span><span class="p">)</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">o</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">r</span>
</code></pre></div></div>

<p>Let’s use the <code class="highlighter-rouge">deep_getsizeof</code> to inspect the size differences between built-in set and <code class="highlighter-rouge">BitSet</code> objects.</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">bs</span> <span class="o">=</span> <span class="n">BitSet</span><span class="p">(</span><span class="n">limit</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span> <span class="n">iterable</span><span class="o">=</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">4</span><span class="p">])</span>
<span class="n">s</span> <span class="o">=</span> <span class="p">{</span><span class="mi">0</span><span class="p">,</span> <span class="mi">4</span><span class="p">}</span>
<span class="k">print</span><span class="p">(</span><span class="n">f</span><span class="s">"Normal Set object: {s}"</span><span class="p">)</span>
<span class="k">print</span><span class="p">(</span><span class="n">f</span><span class="s">"BitSet object: {bs}"</span><span class="p">)</span>
<span class="k">print</span><span class="p">(</span><span class="n">f</span><span class="s">"Size of a normal Set object: {deep_getsizeof(s)} bytes"</span><span class="p">)</span>
<span class="k">print</span><span class="p">(</span><span class="n">f</span><span class="s">"Size of a BitSet object: {deep_getsizeof(bs)} bytes"</span><span class="p">)</span>
</code></pre></div></div>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>Normal Set object: {0, 4}
BitSet object: BitSet(limit=5, iterable=[0, 4])
Size of a normal Set object: 268 bytes
Size of a BitSet object: 100 bytes
</code></pre></div></div>

<p>The output of the print statements reveal that the <code class="highlighter-rouge">BitSet</code> object uses less than half the memory compared to its built-in counterpart!</p>

<h3 id="sqlalchemydict">
<a class="anchor" href="#sqlalchemydict" aria-hidden="true"><span class="octicon octicon-link"></span></a>SQLAlchemyDict</h3>

<p>Here goes the second type of custom data structure that I mentioned in the introduction. It’s also a mutable dict-like structure that can automatically store key-value pairs to any SQLAlchemy supported relational database when initialized.</p>

<p>I was inspired to write this one from the same Raymond Hettinger talk that I mentioned before. For demonstration purposes, I’ve chosen <code class="highlighter-rouge">SQLite</code> databse to store the key value pairs.</p>

<p>This structure gives you immense power since you can abstract away the entire process of database communication inside the custom object. You’ll perform <code class="highlighter-rouge">get-set-delete</code> operations on the object just like you’d do so with built-in dictionary objects and the custom object will take care of storing and updating the data to the target database.</p>

<p>Before running the code snippet below, you’ll need to install SQLAlchemy as an external dependency.</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">sqla_dict</span><span class="o">.</span><span class="n">py</span>
<span class="s">"""
This is a self contained custom data structure with dict like
key-value storage capabilities.
* Can store the key-value pairs in any sqlalchemy supported db
* Employs thread safe transactional scope
* Modular, just change the session_scope to use a different db
* This example uses sqlite db for demonstration purpose
The code is inspired by Raymond Hettinger's talk `Build powerful,
new data structures with Python's abstract base classes`.
https://www.youtube.com/watch?v=S_ipdVNSFlo
MIT License
Copyright (c) 2020 Redowan Delowar
Permission is hereby granted, free of charge, to any person obtaining a copy
of this software and associated documentation files (the "Software"), to deal
in the Software without restriction, including without limitation the rights
to use, copy, modify, merge, publish, distribute, sublicense, and/or sell
copies of the Software, and to permit persons to whom the Software is
furnished to do so, subject to the following conditions:
The above copyright notice and this permission notice shall be included in all
copies or substantial portions of the Software.
THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE
AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER
LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,
OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE
SOFTWARE.
"""</span>


<span class="kn">from</span> <span class="nn">collections.abc</span> <span class="kn">import</span> <span class="n">MutableMapping</span>
<span class="kn">from</span> <span class="nn">contextlib</span> <span class="kn">import</span> <span class="n">contextmanager</span>
<span class="kn">from</span> <span class="nn">operator</span> <span class="kn">import</span> <span class="n">itemgetter</span>

<span class="kn">from</span> <span class="nn">sqlalchemy</span> <span class="kn">import</span> <span class="n">create_engine</span><span class="p">,</span> <span class="n">text</span>
<span class="kn">from</span> <span class="nn">sqlalchemy.exc</span> <span class="kn">import</span> <span class="n">OperationalError</span>
<span class="kn">from</span> <span class="nn">sqlalchemy.orm</span> <span class="kn">import</span> <span class="n">sessionmaker</span>


<span class="k">def</span> <span class="nf">create_transaction_session</span><span class="p">(</span><span class="n">dburl</span><span class="p">):</span>
    <span class="c1"># an engine, which the Session will use for connection resources
</span>    <span class="n">some_engine</span> <span class="o">=</span> <span class="n">create_engine</span><span class="p">(</span><span class="n">dburl</span><span class="p">)</span>

    <span class="c1"># create a configured "Session" class
</span>    <span class="n">Session</span> <span class="o">=</span> <span class="n">sessionmaker</span><span class="p">(</span><span class="n">bind</span><span class="o">=</span><span class="n">some_engine</span><span class="p">)</span>

    <span class="o">@</span><span class="n">contextmanager</span>
    <span class="k">def</span> <span class="nf">session_scope</span><span class="p">():</span>
        <span class="s">"""Provide a transactional scope around a series of operations."""</span>
        
        <span class="n">session</span> <span class="o">=</span> <span class="n">Session</span><span class="p">()</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="k">yield</span> <span class="n">session</span>
            <span class="n">session</span><span class="o">.</span><span class="n">commit</span><span class="p">()</span>

        <span class="k">except</span> <span class="n">OperationalError</span><span class="p">:</span>
            <span class="k">pass</span>

        <span class="k">except</span> <span class="nb">Exception</span><span class="p">:</span>
            <span class="n">session</span><span class="o">.</span><span class="n">rollback</span><span class="p">()</span>
            <span class="k">raise</span>
        <span class="k">finally</span><span class="p">:</span>
            <span class="n">session</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>

    <span class="k">return</span> <span class="n">session_scope</span>


<span class="n">session_scope</span> <span class="o">=</span> <span class="n">create_transaction_session</span><span class="p">(</span><span class="s">"sqlite:///foo.db"</span><span class="p">)</span>


<span class="k">class</span> <span class="nc">SQLAlechemyDict</span><span class="p">(</span><span class="n">MutableMapping</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">dbname</span><span class="p">,</span> <span class="n">session_scope</span><span class="p">,</span> <span class="n">items</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">dbname</span> <span class="o">=</span> <span class="n">dbname</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">session_scope</span> <span class="o">=</span> <span class="n">session_scope</span>

        <span class="k">if</span> <span class="n">items</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
            <span class="n">items</span> <span class="o">=</span> <span class="p">[]</span>

        <span class="k">with</span> <span class="bp">self</span><span class="o">.</span><span class="n">session_scope</span><span class="p">()</span> <span class="k">as</span> <span class="n">session</span><span class="p">:</span>
            <span class="n">session</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="s">"CREATE TABLE Dict (key text, value text)"</span><span class="p">)</span>
            <span class="n">session</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="s">"CREATE UNIQUE INDEX KIndx ON Dict (key)"</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">items</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">__setitem__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">key</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">key</span> <span class="ow">in</span> <span class="bp">self</span><span class="p">:</span>
            <span class="k">del</span> <span class="bp">self</span><span class="p">[</span><span class="n">key</span><span class="p">]</span>

        <span class="k">with</span> <span class="bp">self</span><span class="o">.</span><span class="n">session_scope</span><span class="p">()</span> <span class="k">as</span> <span class="n">session</span><span class="p">:</span>
            <span class="n">session</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span>
                <span class="n">text</span><span class="p">(</span><span class="s">"INSERT INTO  Dict VALUES (:key, :value)"</span><span class="p">),</span>
                <span class="p">{</span><span class="s">"key"</span><span class="p">:</span> <span class="n">key</span><span class="p">,</span> <span class="s">"value"</span><span class="p">:</span> <span class="n">value</span><span class="p">},</span>
            <span class="p">)</span>

    <span class="k">def</span> <span class="nf">__getitem__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">key</span><span class="p">):</span>
        <span class="k">with</span> <span class="bp">self</span><span class="o">.</span><span class="n">session_scope</span><span class="p">()</span> <span class="k">as</span> <span class="n">session</span><span class="p">:</span>
            <span class="n">r</span> <span class="o">=</span> <span class="n">session</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span>
                <span class="n">text</span><span class="p">(</span><span class="s">"SELECT value FROM Dict WHERE key=:key"</span><span class="p">),</span> <span class="p">{</span><span class="s">"key"</span><span class="p">:</span> <span class="n">key</span><span class="p">}</span>
            <span class="p">)</span>
            <span class="n">row</span> <span class="o">=</span> <span class="n">r</span><span class="o">.</span><span class="n">fetchone</span><span class="p">()</span>

            <span class="k">if</span> <span class="n">row</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
                <span class="k">raise</span> <span class="nb">KeyError</span><span class="p">(</span><span class="n">key</span><span class="p">)</span>
            <span class="k">return</span> <span class="n">row</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>

    <span class="k">def</span> <span class="nf">__delitem__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">key</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">key</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="p">:</span>
            <span class="k">raise</span> <span class="nb">KeyError</span><span class="p">(</span><span class="n">key</span><span class="p">)</span>

        <span class="k">with</span> <span class="bp">self</span><span class="o">.</span><span class="n">session_scope</span><span class="p">()</span> <span class="k">as</span> <span class="n">session</span><span class="p">:</span>
            <span class="n">session</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="n">text</span><span class="p">(</span><span class="s">"DELETE FROM Dict WHERE key=:key"</span><span class="p">),</span> <span class="p">{</span><span class="s">"key"</span><span class="p">:</span> <span class="n">key</span><span class="p">})</span>

    <span class="k">def</span> <span class="nf">__len__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">with</span> <span class="bp">self</span><span class="o">.</span><span class="n">session_scope</span><span class="p">()</span> <span class="k">as</span> <span class="n">session</span><span class="p">:</span>
            <span class="n">r</span> <span class="o">=</span> <span class="n">session</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="s">"SELECT COUNT(*) FROM Dict"</span><span class="p">)</span>
            <span class="k">return</span> <span class="nb">next</span><span class="p">(</span><span class="n">r</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>

    <span class="k">def</span> <span class="nf">__iter__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">with</span> <span class="bp">self</span><span class="o">.</span><span class="n">session_scope</span><span class="p">()</span> <span class="k">as</span> <span class="n">session</span><span class="p">:</span>
            <span class="n">r</span> <span class="o">=</span> <span class="n">session</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="s">"SELECT key FROM Dict"</span><span class="p">)</span>
            <span class="k">return</span> <span class="nb">map</span><span class="p">(</span><span class="n">itemgetter</span><span class="p">(</span><span class="mi">0</span><span class="p">),</span> <span class="n">r</span><span class="o">.</span><span class="n">fetchall</span><span class="p">())</span>

    <span class="k">def</span> <span class="nf">__repr__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="p">(</span>
            <span class="n">f</span><span class="s">"{type(self).__name__}(dbname={self.dbname!r}, items={list(self.items())})"</span>
        <span class="p">)</span>

    <span class="k">def</span> <span class="nf">vacuum</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">with</span> <span class="bp">self</span><span class="o">.</span><span class="n">session_scope</span><span class="p">()</span> <span class="k">as</span> <span class="n">session</span><span class="p">:</span>
            <span class="n">session</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="s">"VACUUM;"</span><span class="p">)</span>


<span class="k">if</span> <span class="n">__name__</span> <span class="o">==</span> <span class="s">"__main__"</span><span class="p">:</span>
    <span class="c1"># test the struct
</span>    <span class="n">sqladict</span> <span class="o">=</span> <span class="n">SQLAlechemyDict</span><span class="p">(</span>
        <span class="n">dbname</span><span class="o">=</span><span class="s">"foo.db"</span><span class="p">,</span> <span class="n">session_scope</span><span class="o">=</span><span class="n">session_scope</span><span class="p">,</span> <span class="n">items</span><span class="o">=</span><span class="p">{</span><span class="s">"hello"</span><span class="p">:</span> <span class="s">"world"</span><span class="p">}</span>
    <span class="p">)</span>
    <span class="k">print</span><span class="p">(</span><span class="n">sqladict</span><span class="p">)</span>
    <span class="n">sqladict</span><span class="p">[</span><span class="s">"key"</span><span class="p">]</span> <span class="o">=</span> <span class="s">"val"</span>

    <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">sqladict</span><span class="p">:</span>
        <span class="k">print</span><span class="p">(</span><span class="n">key</span><span class="p">)</span>

    <span class="c1"># &gt;&gt;&gt; SQLAlechemyDict(dbname='foo.db', items=[('hello', 'world'), ('key', 'val')])
</span>    <span class="c1"># &gt;&gt;&gt; hello
</span>    <span class="c1"># &gt;&gt;&gt; key
</span></code></pre></div></div>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>SQLAlechemyDict(dbname='foo.db', items=[('hello', 'world'), ('key', 'val')])
hello
key
</code></pre></div></div>

<p>Running the above code snippet will create a SQLite database named <code class="highlighter-rouge">foo.db</code> in your current working directory. You can inspect the database with any database viewer and find your key-value pairs there. Everything else is the same as a built-in dictionary object.</p>

<h2 id="remarks">
<a class="anchor" href="#remarks" aria-hidden="true"><span class="octicon octicon-link"></span></a>Remarks</h2>

<p>All the pieces of codes in the blog were written and tested with Python 3.8 on a machine running Ubuntu 18.04. Familiarity with built-in data structures, basic object-oriented protocols, decorators, dunder methods etc is assumed.</p>

<h2 id="references">
<a class="anchor" href="#references" aria-hidden="true"><span class="octicon octicon-link"></span></a>References</h2>

<ul>
  <li><a href="https://realpython.com/python-interface/">Implementing an Interface in Python - Real Python</a></li>
  <li><a href="https://stackoverflow.com/questions/533631/what-is-a-mixin-and-why-are-they-useful">What is a mixin, and why are they useful? - Stack Overflow</a></li>
  <li><a href="https://easyaspython.com/mixins-for-fun-and-profit-cb9962760556">Mixins for Fun and Profit - Dan Hillard</a></li>
  <li><a href="https://github.com/psf/requests/blob/8149e9fe54c36951290f198e90d83c8a0498289c/requests/models.py#L60">Mixins in the Requests Library</a></li>
  <li><a href="https://www.youtube.com/watch?v=S_ipdVNSFlo">Build powerful, new data structures with Python’s abstract base classes - Raymond Hettinger</a></li>
</ul>

  </div><!-- from https://github.com/utterance/utterances -->
<script src="https://utteranc.es/client.js"
        repo="rednafi/digressions"
        issue-term="title"
        label="blogpost-comment"
        theme="github-light"
        crossorigin="anonymous"
        async>
</script><a class="u-url" href="/digressions/python/2020/07/03/python-mixins.html" hidden></a>
</article>

      </div>
    </main><footer class="site-footer h-card">
  <data class="u-url" href="/digressions/"></data>

  <div class="wrapper">

    <div class="footer-col-wrapper">
      <div class="footer-col">
        <p class="feed-subscribe">
          <a href="/digressions/feed.xml">
            <svg class="svg-icon orange">
              <use xlink:href="/digressions/assets/minima-social-icons.svg#rss"></use>
            </svg><span>Subscribe</span>
          </a>
        </p>
      </div>
      <div class="footer-col">
        <p>Sporadic cogitations on software, tech &amp; personal beliefs</p>
      </div>
    </div>

    <div class="social-links"><ul class="social-media-list"><li><a rel="me" href="https://github.com/rednafi" title="rednafi"><svg class="svg-icon grey"><use xlink:href="/digressions/assets/minima-social-icons.svg#github"></use></svg></a></li><li><a rel="me" href="https://twitter.com/rednafi" title="rednafi"><svg class="svg-icon grey"><use xlink:href="/digressions/assets/minima-social-icons.svg#twitter"></use></svg></a></li></ul>
</div>

  </div>

</footer>
</body>

</html>
